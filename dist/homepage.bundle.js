/*! For license information please see homepage.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const s=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,h=a?t[e+2]:0,c=s>>2,u=(3&s)<<4|o>>4;let l=(15&o)<<2|h>>6,d=63&h;a||(d=64,i||(l=64)),r.push(n[c],n[u],n[l],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const h=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==o||null==a||null==h)throw new r;const c=i<<2|o>>4;if(s.push(c),64!==a){const t=o<<4&240|a>>2;if(s.push(t),64!==h){const t=a<<6&192|h;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(t){return function(t){const r=e(t);return n.encodeByteArray(r,!0)}(t).replace(/\./g,"")},i=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=i())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function c(){try{return"object"==typeof indexedDB}catch(t){return!1}}class u extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,u.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,l.prototype.create)}}class l{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,s=this.errors[t],i=s?function(t,e){return t.replace(d,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new u(r,o,n)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(p(n)&&p(i)){if(!f(n,i))return!1}else if(n!==i)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function p(t){return null!==t&&"object"==typeof t}function g(t){return t&&t._delegate?t._delegate:t}class m{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const y="[DEFAULT]";class v{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:y})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=y){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=y){return this.instances.has(t)}getOptions(t=y){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===y?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=y){return this.component?this.component.multipleInstances?t:y:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class w{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new v(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const E=[];var b;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(b||(b={}));const _={debug:b.DEBUG,verbose:b.VERBOSE,info:b.INFO,warn:b.WARN,error:b.ERROR,silent:b.SILENT},T=b.INFO,I={[b.DEBUG]:"log",[b.VERBOSE]:"log",[b.INFO]:"info",[b.WARN]:"warn",[b.ERROR]:"error"},S=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),s=I[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${r}]  ${t.name}:`,...n)};class C{constructor(t){this.name=t,this._logLevel=T,this._logHandler=S,this._userLogHandler=null,E.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in b))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?_[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,b.DEBUG,...t),this._logHandler(this,b.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,b.VERBOSE,...t),this._logHandler(this,b.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,b.INFO,...t),this._logHandler(this,b.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,b.WARN,...t),this._logHandler(this,b.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,b.ERROR,...t),this._logHandler(this,b.ERROR,...t)}}const A=(t,e)=>e.some((e=>t instanceof e));let D,N;const k=new WeakMap,x=new WeakMap,L=new WeakMap,R=new WeakMap,O=new WeakMap;let M={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return x.get(t);if("objectStoreNames"===e)return t.objectStoreNames||L.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return V(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function P(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(N||(N=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(F(this),t),V(k.get(this))}:function(...t){return V(e.apply(F(this),t))}:function(t,...n){const r=e.call(F(this),t,...n);return L.set(r,t.sort?t.sort():[t]),V(r)}:(t instanceof IDBTransaction&&function(t){if(x.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)}));x.set(t,e)}(t),A(t,D||(D=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,M):t);var e}function V(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(V(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&k.set(e,t)})).catch((()=>{})),O.set(e,t),e}(t);if(R.has(t))return R.get(t);const e=P(t);return e!==t&&(R.set(t,e),O.set(e,t)),e}const F=t=>O.get(t),U=["get","getKey","getAll","getAllKeys","count"],B=["put","add","delete","clear"],j=new Map;function q(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(j.get(e))return j.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=B.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!U.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&i.done]))[0]};return j.set(e,i),i}var $;$=M,M={...$,get:(t,e,n)=>q(t,e)||$.get(t,e,n),has:(t,e)=>!!q(t,e)||$.has(t,e)};class z{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const K="@firebase/app",G="0.9.26",H=new C("@firebase/app"),Q="[DEFAULT]",W={[K]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},X=new Map,Y=new Map;function J(t,e){try{t.container.addComponent(e)}catch(n){H.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Z(t){const e=t.name;if(Y.has(e))return H.debug(`There were multiple attempts to register component ${e}.`),!1;Y.set(e,t);for(const e of X.values())J(e,t);return!0}const tt=new l("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class et{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new m("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw tt.create("app-deleted",{appName:this._name})}}function nt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:Q,automaticDataCollectionEnabled:!1},e),s=r.name;if("string"!=typeof s||!s)throw tt.create("bad-app-name",{appName:String(s)});if(n||(n=o()),!n)throw tt.create("no-options");const i=X.get(s);if(i){if(f(n,i.options)&&f(r,i.config))return i;throw tt.create("duplicate-app",{appName:s})}const a=new w(s);for(const t of Y.values())a.addComponent(t);const h=new et(n,r,a);return X.set(s,h),h}function rt(t,e,n){var r;let s=null!==(r=W[t])&&void 0!==r?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const t=[`Unable to register library "${s}" with version "${e}":`];return i&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void H.warn(t.join(" "))}Z(new m(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const st="firebase-heartbeat-database",it=1,ot="firebase-heartbeat-store";let at=null;function ht(){return at||(at=function(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=V(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(V(o.result),t.oldVersion,t.newVersion,V(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{i&&t.addEventListener("close",(()=>i())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(st,it,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(ot)}catch(t){console.warn(t)}}}).catch((t=>{throw tt.create("idb-open",{originalErrorMessage:t.message})}))),at}async function ct(t,e){try{const n=(await ht()).transaction(ot,"readwrite"),r=n.objectStore(ot);await r.put(e,ut(t)),await n.done}catch(t){if(t instanceof u)H.warn(t.message);else{const e=tt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});H.warn(e.message)}}}function ut(t){return`${t.name}!${t.options.appId}`}class lt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new ft(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=dt();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=dt(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),pt(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),pt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=s(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function dt(){return(new Date).toISOString().substring(0,10)}class ft{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!c()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await ht();return await e.transaction(ot).objectStore(ot).get(ut(t))}catch(t){if(t instanceof u)H.warn(t.message);else{const e=tt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});H.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return ct(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return ct(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function pt(t){return s(JSON.stringify({version:2,heartbeats:t})).length}Z(new m("platform-logger",(t=>new z(t)),"PRIVATE")),Z(new m("heartbeat",(t=>new lt(t)),"PRIVATE")),rt(K,G,""),rt(K,G,"esm2017"),rt("fire-js",""),rt("firebase","10.7.2","app");var gt,mt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},yt={},vt=vt||{},wt=mt||self;function Et(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function bt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var _t="closure_uid_"+(1e9*Math.random()>>>0),Tt=0;function It(t,e,n){return t.call.apply(t.bind,arguments)}function St(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Ct(t,e,n){return(Ct=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?It:St).apply(null,arguments)}function At(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Dt(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function Nt(){this.s=this.s,this.o=this.o}Nt.prototype.s=!1,Nt.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,_t)&&t[_t]||(t[_t]=++Tt))},Nt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const kt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function xt(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Lt(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(Et(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let s=0;s<r;s++)t[e+s]=n[s]}else t.push(n)}}function Rt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Rt.prototype.h=function(){this.defaultPrevented=!0};var Ot=function(){if(!wt.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};wt.addEventListener("test",t,e),wt.removeEventListener("test",t,e)}catch(t){}return t}();function Mt(t){return/^[\s\xa0]*$/.test(t)}function Pt(){var t=wt.navigator;return t&&(t=t.userAgent)?t:""}function Vt(t){return-1!=Pt().indexOf(t)}function Ft(t){return Ft[" "](t),t}Ft[" "]=function(){};var Ut,Bt,jt,qt=Vt("Opera"),$t=Vt("Trident")||Vt("MSIE"),zt=Vt("Edge"),Kt=zt||$t,Gt=Vt("Gecko")&&!(-1!=Pt().toLowerCase().indexOf("webkit")&&!Vt("Edge"))&&!(Vt("Trident")||Vt("MSIE"))&&!Vt("Edge"),Ht=-1!=Pt().toLowerCase().indexOf("webkit")&&!Vt("Edge");function Qt(){var t=wt.document;return t?t.documentMode:void 0}t:{var Wt="",Xt=(Bt=Pt(),Gt?/rv:([^\);]+)(\)|;)/.exec(Bt):zt?/Edge\/([\d\.]+)/.exec(Bt):$t?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Bt):Ht?/WebKit\/(\S+)/.exec(Bt):qt?/(?:Version)[ \/]?(\S+)/.exec(Bt):void 0);if(Xt&&(Wt=Xt?Xt[1]:""),$t){var Yt=Qt();if(null!=Yt&&Yt>parseFloat(Wt)){Ut=String(Yt);break t}}Ut=Wt}wt.document&&$t?jt=Qt()||parseInt(Ut,10)||void 0:jt=void 0;var Jt=jt;function Zt(t,e){if(Rt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Gt){t:{try{Ft(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:te[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Zt.$.h.call(this)}}Dt(Zt,Rt);var te={2:"touch",3:"pen",4:"mouse"};Zt.prototype.h=function(){Zt.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ee="closure_listenable_"+(1e6*Math.random()|0),ne=0;function re(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=s,this.key=++ne,this.fa=this.ia=!1}function se(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function ie(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function oe(t){const e={};for(const n in t)e[n]=t[n];return e}const ae="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function he(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<ae.length;e++)n=ae[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ce(t){this.src=t,this.g={},this.h=0}function ue(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=kt(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(se(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function le(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.fa&&i.listener==e&&i.capture==!!n&&i.la==r)return s}return-1}ce.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=le(t,e,r,s);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new re(e,this.src,i,!!r,s)).ia=n,t.push(e)),e};var de="closure_lm_"+(1e6*Math.random()|0),fe={};function pe(t,e,n,r,s){if(r&&r.once)return me(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)pe(t,e[i],n,r,s);return null}return n=Te(n),t&&t[ee]?t.O(e,n,bt(r)?!!r.capture:!!r,s):ge(t,e,n,!1,r,s)}function ge(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=bt(s)?!!s.capture:!!s,a=be(t);if(a||(t[de]=a=new ce(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){const t=Ee;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Ot||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(we(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function me(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)me(t,e[i],n,r,s);return null}return n=Te(n),t&&t[ee]?t.P(e,n,bt(r)?!!r.capture:!!r,s):ge(t,e,n,!0,r,s)}function ye(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)ye(t,e[i],n,r,s);else r=bt(r)?!!r.capture:!!r,n=Te(n),t&&t[ee]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=le(i=t.g[e],n,r,s))&&(se(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=be(t))&&(e=t.g[e.toString()],t=-1,e&&(t=le(e,n,r,s)),(n=-1<t?e[t]:null)&&ve(n))}function ve(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[ee])ue(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(we(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=be(e))?(ue(n,t),0==n.h&&(n.src=null,e[de]=null)):se(t)}}}function we(t){return t in fe?fe[t]:fe[t]="on"+t}function Ee(t,e){if(t.fa)t=!0;else{e=new Zt(e,this);var n=t.listener,r=t.la||t.src;t.ia&&ve(t),t=n.call(r,e)}return t}function be(t){return(t=t[de])instanceof ce?t:null}var _e="__closure_events_fn_"+(1e9*Math.random()>>>0);function Te(t){return"function"==typeof t?t:(t[_e]||(t[_e]=function(e){return t.handleEvent(e)}),t[_e])}function Ie(){Nt.call(this),this.i=new ce(this),this.S=this,this.J=null}function Se(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new Rt(e,t);else if(e instanceof Rt)e.target=e.target||t;else{var s=e;he(e=new Rt(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=Ce(o,r,!0,e)&&s}if(s=Ce(o=e.g=t,r,!0,e)&&s,s=Ce(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Ce(o=e.g=n[i],r,!1,e)&&s}function Ce(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,h=o.la||o.src;o.ia&&ue(t.i,o),s=!1!==a.call(h,r)&&s}}return s&&!r.defaultPrevented}Dt(Ie,Nt),Ie.prototype[ee]=!0,Ie.prototype.removeEventListener=function(t,e,n,r){ye(this,t,e,n,r)},Ie.prototype.N=function(){if(Ie.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)se(n[r]);delete e.g[t],e.h--}}this.J=null},Ie.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Ie.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Ae=wt.JSON.stringify;function De(){var t=Me;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ne=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new ke),(t=>t.reset()));class ke{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function xe(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Le(t){wt.setTimeout((()=>{throw t}),0)}let Re,Oe=!1,Me=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ne.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Pe=()=>{const t=wt.Promise.resolve(void 0);Re=()=>{t.then(Ve)}};var Ve=()=>{for(var t;t=De();){try{t.h.call(t.g)}catch(t){Le(t)}var e=Ne;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Oe=!1};function Fe(t,e){Ie.call(this),this.h=t||1,this.g=e||wt,this.j=Ct(this.qb,this),this.l=Date.now()}function Ue(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Be(t,e,n){if("function"==typeof t)n&&(t=Ct(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Ct(t.handleEvent,t)}return 2147483647<Number(e)?-1:wt.setTimeout(t,e||0)}function je(t){t.g=Be((()=>{t.g=null,t.i&&(t.i=!1,je(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Dt(Fe,Ie),(gt=Fe.prototype).ga=!1,gt.T=null,gt.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Se(this,"tick"),this.ga&&(Ue(this),this.start()))}},gt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},gt.N=function(){Fe.$.N.call(this),Ue(this),delete this.g};class qe extends Nt{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:je(this)}N(){super.N(),this.g&&(wt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $e(t){Nt.call(this),this.h=t,this.g={}}Dt($e,Nt);var ze=[];function Ke(t,e,n,r){Array.isArray(n)||(n&&(ze[0]=n.toString()),n=ze);for(var s=0;s<n.length;s++){var i=pe(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function Ge(t){ie(t.g,(function(t,e){this.g.hasOwnProperty(e)&&ve(t)}),t),t.g={}}function He(){this.g=!0}function Qe(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ae(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}$e.prototype.N=function(){$e.$.N.call(this),Ge(this)},$e.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},He.prototype.Ea=function(){this.g=!1},He.prototype.info=function(){};var We={},Xe=null;function Ye(){return Xe=Xe||new Ie}function Je(t){Rt.call(this,We.Ta,t)}function Ze(t){const e=Ye();Se(e,new Je(e))}function tn(t,e){Rt.call(this,We.STAT_EVENT,t),this.stat=e}function en(t){const e=Ye();Se(e,new tn(e,t))}function nn(t,e){Rt.call(this,We.Ua,t),this.size=e}function rn(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return wt.setTimeout((function(){t()}),e)}We.Ta="serverreachability",Dt(Je,Rt),We.STAT_EVENT="statevent",Dt(tn,Rt),We.Ua="timingevent",Dt(nn,Rt);var sn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},on={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function an(){}function hn(t){return t.h||(t.h=t.i())}function cn(){}an.prototype.h=null;var un,ln={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function dn(){Rt.call(this,"d")}function fn(){Rt.call(this,"c")}function pn(){}function gn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new $e(this),this.P=yn,t=Kt?125:void 0,this.V=new Fe(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new mn}function mn(){this.i=null,this.g="",this.h=!1}Dt(dn,Rt),Dt(fn,Rt),Dt(pn,an),pn.prototype.g=function(){return new XMLHttpRequest},pn.prototype.i=function(){return{}},un=new pn;var yn=45e3,vn={},wn={};function En(t,e,n){t.L=1,t.A=Un(On(e)),t.u=n,t.S=!0,bn(t,null)}function bn(t,e){t.G=Date.now(),Sn(t),t.B=On(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),Jn(n.i,"t",r),t.o=0,n=t.l.J,t.h=new mn,t.g=Jr(t.l,n?e:null,!t.u),0<t.O&&(t.M=new qe(Ct(t.Pa,t,t.g),t.O)),Ke(t.U,t.g,"readystatechange",t.nb),e=t.I?oe(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),Ze(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),h=0;h<a.length;h++){var c=a[h].split("=");if(1<c.length){var u=c[0];c=c[1];var l=u.split("_");o=2<=l.length&&"type"==l[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function _n(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function Tn(t,e,n){let r,s=!0;for(;!t.J&&t.o<n.length;){if(r=In(t,n),r==wn){4==e&&(t.s=4,en(14),s=!1),Qe(t.j,t.m,null,"[Incomplete Response]");break}if(r==vn){t.s=4,en(15),Qe(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}Qe(t.j,t.m,r,null),kn(t,r)}_n(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,en(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),zr(e),e.M=!0,en(11))):(Qe(t.j,t.m,n,"[Invalid Chunked Response]"),Nn(t),Dn(t))}function In(t,e){var n=t.o,r=e.indexOf("\n",n);return-1==r?wn:(n=Number(e.substring(n,r)),isNaN(n)?vn:(r+=1)+n>e.length?wn:(e=e.slice(r,r+n),t.o=r+n,e))}function Sn(t){t.Y=Date.now()+t.P,Cn(t,t.P)}function Cn(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=rn(Ct(t.lb,t),e)}function An(t){t.C&&(wt.clearTimeout(t.C),t.C=null)}function Dn(t){0==t.l.H||t.J||Hr(t.l,t)}function Nn(t){An(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Ue(t.V),Ge(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function kn(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||ir(n.i,t)))if(!t.K&&ir(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Gr(n),Pr(n)}$r(n),en(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=rn(Ct(n.ib,n),6e3));if(1>=sr(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Wr(n,11)}else if((t.K||n.g==t)&&Gr(n),!Mt(e))for(s=n.Ja.g.parse(e),e=0;e<s.length;e++){let c=s[e];if(n.V=c[0],c=c[1],2==n.H)if("c"==c[0]){n.K=c[1],n.pa=c[2];const e=c[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const s=c[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.i;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(or(i,i.h),i.h=null))}if(r.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,Fn(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=Yr(r,r.J?r.pa:null,r.Y),o.K){ar(r.i,o);var a=o,h=r.L;h&&a.setTimeout(h),a.C&&(An(a),Sn(a)),r.g=o}else qr(r);0<n.j.length&&Fr(n)}else"stop"!=c[0]&&"close"!=c[0]||Wr(n,7);else 3==n.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Wr(n,7):Mr(n):"noop"!=c[0]&&n.h&&n.h.Aa(c),n.A=0)}Ze()}catch(t){}}function xn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Et(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(Et(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(Et(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}(gt=gn.prototype).setTimeout=function(t){this.P=t},gt.nb=function(t){t=t.target;const e=this.M;e&&3==Nr(t)?e.l():this.Pa(t)},gt.Pa=function(t){try{if(t==this.g)t:{const u=Nr(this.g);var e=this.g.Ia();if(this.g.da(),!(3>u)&&(3!=u||Kt||this.g&&(this.h.h||this.g.ja()||kr(this.g)))){this.J||4!=u||7==e||Ze(),An(this);var n=this.g.da();this.ca=n;e:if(_n(this)){var r=kr(this.g);t="";var s=r.length,i=4==Nr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Nn(this),Dn(this);var o="";break e}this.h.i=new wt.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.v,this.B,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,h=this.g;if((a=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Mt(a)){var c=a;break e}}c=null}if(!(n=c)){this.i=!1,this.s=3,en(12),Nn(this),Dn(this);break t}Qe(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,kn(this,n)}this.S?(Tn(this,u,o),Kt&&this.i&&3==u&&(Ke(this.U,this.V,"tick",this.mb),this.V.start())):(Qe(this.j,this.m,o,null),kn(this,o)),4==u&&Nn(this),this.i&&!this.J&&(4==u?Hr(this.l,this):(this.i=!1,Sn(this)))}else(function(t){const e={};t=(t.g&&2<=Nr(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(Mt(t[r]))continue;var n=xe(t[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=e[s]||[];e[s]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,en(12)):(this.s=0,en(13)),Nn(this),Dn(this)}}}catch(t){}},gt.mb=function(){if(this.g){var t=Nr(this.g),e=this.g.ja();this.o<e.length&&(An(this),Tn(this,t,e),this.i&&4!=t&&Sn(this))}},gt.cancel=function(){this.J=!0,Nn(this)},gt.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(Ze(),en(17)),Nn(this),this.s=2,Dn(this)):Cn(this,this.Y-t)};var Ln=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Rn(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Rn){this.h=t.h,Mn(this,t.j),this.s=t.s,this.g=t.g,Pn(this,t.m),this.l=t.l;var e=t.i,n=new Qn;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Vn(this,n),this.o=t.o}else t&&(e=String(t).match(Ln))?(this.h=!1,Mn(this,e[1]||"",!0),this.s=Bn(e[2]||""),this.g=Bn(e[3]||"",!0),Pn(this,e[4]),this.l=Bn(e[5]||"",!0),Vn(this,e[6]||"",!0),this.o=Bn(e[7]||"")):(this.h=!1,this.i=new Qn(null,this.h))}function On(t){return new Rn(t)}function Mn(t,e,n){t.j=n?Bn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Pn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Vn(t,e,n){e instanceof Qn?(t.i=e,function(t,e){e&&!t.j&&(Wn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Xn(this,e),Jn(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=jn(e,Gn)),t.i=new Qn(e,t.h))}function Fn(t,e,n){t.i.set(e,n)}function Un(t){return Fn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Bn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function jn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,qn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function qn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Rn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(jn(e,$n,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(jn(e,$n,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(jn(n,"/"==n.charAt(0)?Kn:zn,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",jn(n,Hn)),t.join("")};var $n=/[#\/\?@]/g,zn=/[#\?:]/g,Kn=/[#\?]/g,Gn=/[#\?@]/g,Hn=/#/g;function Qn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Wn(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Xn(t,e){Wn(t),e=Zn(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Yn(t,e){return Wn(t),e=Zn(t,e),t.g.has(e)}function Jn(t,e,n){Xn(t,e),0<n.length&&(t.i=null,t.g.set(Zn(t,e),xt(n)),t.h+=n.length)}function Zn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(gt=Qn.prototype).add=function(t,e){Wn(this),this.i=null,t=Zn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},gt.forEach=function(t,e){Wn(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},gt.ta=function(){Wn(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let t=0;t<s.length;t++)n.push(e[r])}return n},gt.Z=function(t){Wn(this);let e=[];if("string"==typeof t)Yn(this,t)&&(e=e.concat(this.g.get(Zn(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},gt.set=function(t,e){return Wn(this),this.i=null,Yn(this,t=Zn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},gt.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},gt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),t.push(s)}}return this.i=t.join("&")};var tr=class{constructor(t,e){this.g=t,this.map=e}};function er(t){this.l=t||nr,t=wt.PerformanceNavigationTiming?0<(t=wt.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(wt.g&&wt.g.Ka&&wt.g.Ka()&&wt.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var nr=10;function rr(t){return!!t.h||!!t.g&&t.g.size>=t.j}function sr(t){return t.h?1:t.g?t.g.size:0}function ir(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function or(t,e){t.g?t.g.add(e):t.h=e}function ar(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function hr(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return xt(t.i)}er.prototype.cancel=function(){if(this.i=hr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var cr=class{stringify(t){return wt.JSON.stringify(t,void 0)}parse(t){return wt.JSON.parse(t,void 0)}};function ur(){this.g=new cr}function lr(t,e,n){const r=n||"";try{xn(t,(function(t,n){let s=t;bt(t)&&(s=Ae(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function dr(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}function fr(t){this.l=t.ec||null,this.j=t.ob||!1}function pr(t,e){Ie.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=gr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Dt(fr,an),fr.prototype.g=function(){return new pr(this.l,this.j)},fr.prototype.i=function(t){return function(){return t}}({}),Dt(pr,Ie);var gr=0;function mr(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function yr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,vr(t)}function vr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(gt=pr.prototype).open=function(t,e){if(this.readyState!=gr)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,vr(this)},gt.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||wt).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},gt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,yr(this)),this.readyState=gr},gt.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,vr(this)),this.g&&(this.readyState=3,vr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==wt.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;mr(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},gt.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?yr(this):vr(this),3==this.readyState&&mr(this)}},gt.Za=function(t){this.g&&(this.response=this.responseText=t,yr(this))},gt.Ya=function(t){this.g&&(this.response=t,yr(this))},gt.ka=function(){this.g&&yr(this)},gt.setRequestHeader=function(t,e){this.v.append(t,e)},gt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},gt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(pr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var wr=wt.JSON.parse;function Er(t){Ie.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=br,this.L=this.M=!1}Dt(Er,Ie);var br="",_r=/^https?$/i,Tr=["POST","PUT"];function Ir(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Sr(t),Ar(t)}function Sr(t){t.F||(t.F=!0,Se(t,"complete"),Se(t,"error"))}function Cr(t){if(t.h&&void 0!==vt&&(!t.C[1]||4!=Nr(t)||2!=t.da()))if(t.v&&4==Nr(t))Be(t.La,0,t);else if(Se(t,"readystatechange"),4==Nr(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var s=String(t.I).match(Ln)[1]||null;!s&&wt.self&&wt.self.location&&(s=wt.self.location.protocol.slice(0,-1)),r=!_r.test(s?s.toLowerCase():"")}n=r}if(n)Se(t,"complete"),Se(t,"success");else{t.m=6;try{var i=2<Nr(t)?t.g.statusText:""}catch(t){i=""}t.j=i+" ["+t.da()+"]",Sr(t)}}finally{Ar(t)}}}function Ar(t,e){if(t.g){Dr(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Se(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Dr(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(wt.clearTimeout(t.A),t.A=null)}function Nr(t){return t.g?t.g.readyState:0}function kr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case br:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function xr(t){let e="";return ie(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Lr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=xr(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Fn(t,e,n))}function Rr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Or(t){this.Ga=0,this.j=[],this.l=new He,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Rr("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Rr("baseRetryDelayMs",5e3,t),this.hb=Rr("retryDelaySeedMs",1e4,t),this.eb=Rr("forwardChannelMaxRetries",2,t),this.xa=Rr("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new er(t&&t.concurrentRequestLimit),this.Ja=new ur,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Mr(t){if(Vr(t),3==t.H){var e=t.W++,n=On(t.I);if(Fn(n,"SID",t.K),Fn(n,"RID",e),Fn(n,"TYPE","terminate"),Br(t,n),(e=new gn(t,t.l,e)).L=2,e.A=Un(On(n)),n=!1,wt.navigator&&wt.navigator.sendBeacon)try{n=wt.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&wt.Image&&((new Image).src=e.A,n=!0),n||(e.g=Jr(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Sn(e)}Xr(t)}function Pr(t){t.g&&(zr(t),t.g.cancel(),t.g=null)}function Vr(t){Pr(t),t.u&&(wt.clearTimeout(t.u),t.u=null),Gr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&wt.clearTimeout(t.m),t.m=null)}function Fr(t){if(!rr(t.i)&&!t.m){t.m=!0;var e=t.Na;Re||Pe(),Oe||(Re(),Oe=!0),Me.add(e,t),t.C=0}}function Ur(t,e){var n;n=e?e.m:t.W++;const r=On(t.I);Fn(r,"SID",t.K),Fn(r,"RID",n),Fn(r,"AID",t.V),Br(t,r),t.o&&t.s&&Lr(r,t.o,t.s),n=new gn(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=jr(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),or(t.i,n),En(n,r,e)}function Br(t,e){t.na&&ie(t.na,(function(t,n){Fn(e,n,t)})),t.h&&xn({},(function(t,n){Fn(e,n,t)}))}function jr(t,e,n){n=Math.min(t.j.length,n);var r=t.h?Ct(t.h.Va,t.h,t):null;t:{var s=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=e,0>n)e=Math.max(0,s[o].g-100),i=!1;else try{lr(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(i){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function qr(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Re||Pe(),Oe||(Re(),Oe=!0),Me.add(e,t),t.A=0}}function $r(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=rn(Ct(t.Ma,t),Qr(t,t.A)),t.A++,0))}function zr(t){null!=t.B&&(wt.clearTimeout(t.B),t.B=null)}function Kr(t){t.g=new gn(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=On(t.wa);Fn(e,"RID","rpc"),Fn(e,"SID",t.K),Fn(e,"AID",t.V),Fn(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Fn(e,"TO",t.qa),Fn(e,"TYPE","xmlhttp"),Br(t,e),t.o&&t.s&&Lr(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=Un(On(e)),n.u=null,n.S=!0,bn(n,t)}function Gr(t){null!=t.v&&(wt.clearTimeout(t.v),t.v=null)}function Hr(t,e){var n=null;if(t.g==e){Gr(t),zr(t),t.g=null;var r=2}else{if(!ir(t.i,e))return;n=e.F,ar(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.G;var s=t.C;Se(r=Ye(),new nn(r,n)),Fr(t)}else qr(t);else if(3==(s=e.s)||0==s&&0<e.ca||!(1==r&&function(t,e){return!(sr(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=rn(Ct(t.Na,t,e),Qr(t,t.C)),t.C++,0)))}(t,e)||2==r&&$r(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:Wr(t,5);break;case 4:Wr(t,10);break;case 3:Wr(t,6);break;default:Wr(t,2)}}function Qr(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Wr(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=Ct(t.pb,t);n||(n=new Rn("//www.google.com/images/cleardot.gif"),wt.location&&"http"==wt.location.protocol||Mn(n,"https"),Un(n)),function(t,e){const n=new He;if(wt.Image){const r=new Image;r.onload=At(dr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=At(dr,n,r,"TestLoadImage: error",!1,e),r.onabort=At(dr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=At(dr,n,r,"TestLoadImage: timeout",!1,e),wt.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else en(2);t.H=0,t.h&&t.h.za(e),Xr(t),Vr(t)}function Xr(t){if(t.H=0,t.ma=[],t.h){const e=hr(t.i);0==e.length&&0==t.j.length||(Lt(t.ma,e),Lt(t.ma,t.j),t.i.i.length=0,xt(t.j),t.j.length=0),t.h.ya()}}function Yr(t,e,n){var r=n instanceof Rn?On(n):new Rn(n);if(""!=r.g)e&&(r.g=e+"."+r.g),Pn(r,r.m);else{var s=wt.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new Rn(null);r&&Mn(i,r),e&&(i.g=e),s&&Pn(i,s),n&&(i.l=n),r=i}return n=t.F,e=t.Da,n&&e&&Fn(r,n,e),Fn(r,"VER",t.ra),Br(t,r),r}function Jr(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new Er(new fr({ob:n})):new Er(t.va)).Oa(t.J),e}function Zr(){}function ts(){if($t&&!(10<=Number(Jt)))throw Error("Environmental error: no available transport.")}function es(t,e){Ie.call(this),this.g=new Or(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Mt(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Mt(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new ss(this)}function ns(t){dn.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function rs(){fn.call(this),this.status=1}function ss(t){this.g=t}function is(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function os(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var i=t.g[3],o=e+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=n+(o<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=n+((o=e+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(e^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+i&4294967295}function as(t,e){this.h=e;for(var n=[],r=!0,s=t.length-1;0<=s;s--){var i=0|t[s];r&&i==e||(n[s]=i,r=!1)}this.g=n}(gt=Er.prototype).Oa=function(t){this.M=t},gt.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():un.g(),this.C=this.u?hn(this.u):hn(un),this.g.onreadystatechange=Ct(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Ir(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=wt.FormData&&t instanceof wt.FormData,!(0<=kt(Tr,e))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Dr(this),0<this.B&&((this.L=function(t){return $t&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ct(this.ua,this)):this.A=Be(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Ir(this,t)}},gt.ua=function(){void 0!==vt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Se(this,"timeout"),this.abort(8))},gt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Se(this,"complete"),Se(this,"abort"),Ar(this))},gt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ar(this,!0)),Er.$.N.call(this)},gt.La=function(){this.s||(this.G||this.v||this.l?Cr(this):this.kb())},gt.kb=function(){Cr(this)},gt.isActive=function(){return!!this.g},gt.da=function(){try{return 2<Nr(this)?this.g.status:-1}catch(t){return-1}},gt.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},gt.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),wr(e)}},gt.Ia=function(){return this.m},gt.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(gt=Or.prototype).ra=8,gt.H=1,gt.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new gn(this,this.l,t);let i=this.s;if(this.U&&(i?(i=oe(i),he(i,this.U)):i=this.U),null!==this.o||this.O||(s.I=i,i=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=jr(this,s,e),Fn(n=On(this.I),"RID",t),Fn(n,"CVER",22),this.F&&Fn(n,"X-HTTP-Session-Id",this.F),Br(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(xr(i)))+"&"+e:this.o&&Lr(n,this.o,i)),or(this.i,s),this.bb&&Fn(n,"TYPE","init"),this.P?(Fn(n,"$req",e),Fn(n,"SID","null"),s.aa=!0,En(s,n,null)):En(s,n,e),this.H=2}}else 3==this.H&&(t?Ur(this,t):0==this.j.length||rr(this.i)||Ur(this))},gt.Ma=function(){if(this.u=null,Kr(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=rn(Ct(this.jb,this),t)}},gt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,en(10),Pr(this),Kr(this))},gt.ib=function(){null!=this.v&&(this.v=null,Pr(this),$r(this),en(19))},gt.pb=function(t){t?(this.l.info("Successfully pinged google.com"),en(2)):(this.l.info("Failed to ping google.com"),en(1))},gt.isActive=function(){return!!this.h&&this.h.isActive(this)},(gt=Zr.prototype).Ba=function(){},gt.Aa=function(){},gt.za=function(){},gt.ya=function(){},gt.isActive=function(){return!0},gt.Va=function(){},ts.prototype.g=function(t,e){return new es(t,e)},Dt(es,Ie),es.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;en(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Yr(t,null,t.Y),Fr(t)},es.prototype.close=function(){Mr(this.g)},es.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=Ae(t),t=n);e.j.push(new tr(e.fb++,t)),3==e.H&&Fr(e)},es.prototype.N=function(){this.g.h=null,delete this.j,Mr(this.g),delete this.g,es.$.N.call(this)},Dt(ns,dn),Dt(rs,fn),Dt(ss,Zr),ss.prototype.Ba=function(){Se(this.g,"a")},ss.prototype.Aa=function(t){Se(this.g,new ns(t))},ss.prototype.za=function(t){Se(this.g,new rs)},ss.prototype.ya=function(){Se(this.g,"b")},Dt(is,(function(){this.blockSize=-1})),is.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},is.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,s=this.h,i=0;i<e;){if(0==s)for(;i<=n;)os(this,t,i),i+=this.blockSize;if("string"==typeof t){for(;i<e;)if(r[s++]=t.charCodeAt(i++),s==this.blockSize){os(this,r),s=0;break}}else for(;i<e;)if(r[s++]=t[i++],s==this.blockSize){os(this,r),s=0;break}}this.h=s,this.i+=e},is.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var hs={};function cs(t){return-128<=t&&128>t?function(t,e){var n=hs;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new as([0|t],0>t?-1:0)}(t)}(t):new as([0|t],0>t?-1:0)}function us(t){if(isNaN(t)||!isFinite(t))return ds;if(0>t)return ys(us(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=ls;return new as(e,0)}var ls=4294967296,ds=cs(0),fs=cs(1),ps=cs(16777216);function gs(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function ms(t){return-1==t.h}function ys(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new as(n,~t.h).add(fs)}function vs(t,e){return t.add(ys(e))}function ws(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Es(t,e){this.g=t,this.h=e}function bs(t,e){if(gs(e))throw Error("division by zero");if(gs(t))return new Es(ds,ds);if(ms(t))return e=bs(ys(t),e),new Es(ys(e.g),ys(e.h));if(ms(e))return e=bs(t,ys(e)),new Es(ys(e.g),e.h);if(30<t.g.length){if(ms(t)||ms(e))throw Error("slowDivide_ only works with positive integers.");for(var n=fs,r=e;0>=r.X(t);)n=_s(n),r=_s(r);var s=Ts(n,1),i=Ts(r,1);for(r=Ts(r,2),n=Ts(n,2);!gs(r);){var o=i.add(r);0>=o.X(t)&&(s=s.add(n),i=o),r=Ts(r,1),n=Ts(n,1)}return e=vs(t,s.R(e)),new Es(s,e)}for(s=ds;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(i=us(n)).R(e);ms(o)||0<o.X(t);)o=(i=us(n-=r)).R(e);gs(i)&&(i=fs),s=s.add(i),t=vs(t,o)}return new Es(s,t)}function _s(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new as(n,t.h)}function Ts(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,s=[],i=0;i<r;i++)s[i]=0<e?t.D(i+n)>>>e|t.D(i+n+1)<<32-e:t.D(i+n);return new as(s,t.h)}(gt=as.prototype).ea=function(){if(ms(this))return-ys(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:ls+r)*e,e*=ls}return t},gt.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(gs(this))return"0";if(ms(this))return"-"+ys(this).toString(t);for(var e=us(Math.pow(t,6)),n=this,r="";;){var s=bs(n,e).g,i=((0<(n=vs(n,s.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(gs(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},gt.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},gt.X=function(t){return ms(t=vs(this,t))?-1:gs(t)?0:1},gt.abs=function(){return ms(this)?ys(this):this},gt.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,s=0;s<=e;s++){var i=r+(65535&this.D(s))+(65535&t.D(s)),o=(i>>>16)+(this.D(s)>>>16)+(t.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,n[s]=o<<16|i}return new as(n,-2147483648&n[n.length-1]?-1:0)},gt.R=function(t){if(gs(this)||gs(t))return ds;if(ms(this))return ms(t)?ys(this).R(ys(t)):ys(ys(this).R(t));if(ms(t))return ys(this.R(ys(t)));if(0>this.X(ps)&&0>t.X(ps))return us(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<t.g.length;s++){var i=this.D(r)>>>16,o=65535&this.D(r),a=t.D(s)>>>16,h=65535&t.D(s);n[2*r+2*s]+=o*h,ws(n,2*r+2*s),n[2*r+2*s+1]+=i*h,ws(n,2*r+2*s+1),n[2*r+2*s+1]+=o*a,ws(n,2*r+2*s+1),n[2*r+2*s+2]+=i*a,ws(n,2*r+2*s+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new as(n,0)},gt.gb=function(t){return bs(this,t).h},gt.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new as(n,this.h&t.h)},gt.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new as(n,this.h|t.h)},gt.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new as(n,this.h^t.h)},ts.prototype.createWebChannel=ts.prototype.g,es.prototype.send=es.prototype.u,es.prototype.open=es.prototype.m,es.prototype.close=es.prototype.close,sn.NO_ERROR=0,sn.TIMEOUT=8,sn.HTTP_ERROR=6,on.COMPLETE="complete",cn.EventType=ln,ln.OPEN="a",ln.CLOSE="b",ln.ERROR="c",ln.MESSAGE="d",Ie.prototype.listen=Ie.prototype.O,Er.prototype.listenOnce=Er.prototype.P,Er.prototype.getLastError=Er.prototype.Sa,Er.prototype.getLastErrorCode=Er.prototype.Ia,Er.prototype.getStatus=Er.prototype.da,Er.prototype.getResponseJson=Er.prototype.Wa,Er.prototype.getResponseText=Er.prototype.ja,Er.prototype.send=Er.prototype.ha,Er.prototype.setWithCredentials=Er.prototype.Oa,is.prototype.digest=is.prototype.l,is.prototype.reset=is.prototype.reset,is.prototype.update=is.prototype.j,as.prototype.add=as.prototype.add,as.prototype.multiply=as.prototype.R,as.prototype.modulo=as.prototype.gb,as.prototype.compare=as.prototype.X,as.prototype.toNumber=as.prototype.ea,as.prototype.toString=as.prototype.toString,as.prototype.getBits=as.prototype.D,as.fromNumber=us,as.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return ys(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=us(Math.pow(n,8)),s=ds,i=0;i<e.length;i+=8){var o=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+o),n);8>o?(o=us(Math.pow(n,o)),s=s.R(o).add(us(a))):s=(s=s.R(r)).add(us(a))}return s};var Is=yt.createWebChannelTransport=function(){return new ts},Ss=yt.getStatEventTarget=function(){return Ye()},Cs=yt.ErrorCode=sn,As=yt.EventType=on,Ds=yt.Event=We,Ns=yt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},ks=(yt.FetchXmlHttpFactory=fr,yt.WebChannel=cn),xs=yt.XhrIo=Er,Ls=yt.Md5=is,Rs=yt.Integer=as;const Os="@firebase/firestore";class Ms{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Ms.UNAUTHENTICATED=new Ms(null),Ms.GOOGLE_CREDENTIALS=new Ms("google-credentials-uid"),Ms.FIRST_PARTY=new Ms("first-party-uid"),Ms.MOCK_USER=new Ms("mock-user");let Ps="10.7.2";const Vs=new C("@firebase/firestore");function Fs(){return Vs.logLevel}function Us(t,...e){if(Vs.logLevel<=b.DEBUG){const n=e.map(qs);Vs.debug(`Firestore (${Ps}): ${t}`,...n)}}function Bs(t,...e){if(Vs.logLevel<=b.ERROR){const n=e.map(qs);Vs.error(`Firestore (${Ps}): ${t}`,...n)}}function js(t,...e){if(Vs.logLevel<=b.WARN){const n=e.map(qs);Vs.warn(`Firestore (${Ps}): ${t}`,...n)}}function qs(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function $s(t="Unexpected state"){const e=`FIRESTORE (${Ps}) INTERNAL ASSERTION FAILED: `+t;throw Bs(e),new Error(e)}function zs(t,e){t||$s()}function Ks(t,e){return t}const Gs={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Hs extends u{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Qs{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Ws{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Xs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Ms.UNAUTHENTICATED)))}shutdown(){}}class Ys{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Js{constructor(t){this.t=t,this.currentUser=Ms.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new Qs;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Qs,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{Us("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Us("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Qs)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Us("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(zs("string"==typeof e.accessToken),new Ws(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return zs(null===t||"string"==typeof t),new Ms(t)}}class Zs{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Ms.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ti{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Zs(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Ms.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ei{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ni{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&Us("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,Us("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{Us("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):Us("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(zs("string"==typeof t.token),this.R=t.token,new ei(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function ri(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class si{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=ri(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function ii(t,e){return t<e?-1:t>e?1:0}function oi(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class ai{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Hs(Gs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Hs(Gs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Hs(Gs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Hs(Gs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return ai.fromMillis(Date.now())}static fromDate(t){return ai.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new ai(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?ii(this.nanoseconds,t.nanoseconds):ii(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class hi{constructor(t){this.timestamp=t}static fromTimestamp(t){return new hi(t)}static min(){return new hi(new ai(0,0))}static max(){return new hi(new ai(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ci{constructor(t,e,n){void 0===e?e=0:e>t.length&&$s(),void 0===n?n=t.length-e:n>t.length-e&&$s(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===ci.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ci?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ui extends ci{construct(t,e,n){return new ui(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Hs(Gs.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ui(e)}static emptyPath(){return new ui([])}}const li=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class di extends ci{construct(t,e,n){return new di(t,e,n)}static isValidIdentifier(t){return li.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),di.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new di(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new Hs(Gs.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Hs(Gs.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Hs(Gs.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new Hs(Gs.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new di(e)}static emptyPath(){return new di([])}}class fi{constructor(t){this.path=t}static fromPath(t){return new fi(ui.fromString(t))}static fromName(t){return new fi(ui.fromString(t).popFirst(5))}static empty(){return new fi(ui.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ui.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ui.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new fi(new ui(t.slice()))}}function pi(t){return new gi(t.readTime,t.key,-1)}class gi{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new gi(hi.min(),fi.empty(),-1)}static max(){return new gi(hi.max(),fi.empty(),-1)}}function mi(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=fi.comparator(t.documentKey,e.documentKey),0!==n?n:ii(t.largestBatchId,e.largestBatchId))}const yi="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function wi(t){if(t.code!==Gs.FAILED_PRECONDITION||t.message!==yi)throw t;Us("LocalStore","Unexpectedly lost primary lease")}class Ei{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&$s(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Ei(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Ei?e:Ei.resolve(e)}catch(t){return Ei.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Ei.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Ei.reject(e)}static resolve(t){return new Ei(((e,n)=>{e(t)}))}static reject(t){return new Ei(((e,n)=>{n(t)}))}static waitFor(t){return new Ei(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=Ei.resolve(!1);for(const n of t)e=e.next((t=>t?Ei.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new Ei(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const h=a;e(t[h]).next((t=>{i[h]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new Ei(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}class bi{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new Qs,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Ii(t,e.error)):this.V.resolve()},this.transaction.onerror=e=>{const n=Ni(e.target.error);this.V.reject(new Ii(t,n))}}static open(t,e,n,r){try{return new bi(e,t.transaction(r,n))}catch(t){throw new Ii(e,t)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(Us("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Ci(e)}}class _i{constructor(t,e,n){this.name=t,this.version=e,this.p=n,12.2===_i.S(h())&&Bs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Us("SimpleDb","Removing database:",t),Ai(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!c())return!1;if(_i.C())return!0;const t=h(),e=_i.S(t),n=0<e&&e<10,r=_i.v(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static C(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(t){return this.db||(Us("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Ii(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new Hs(Gs.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Hs(Gs.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Ii(t,r))},r.onupgradeneeded=t=>{Us("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.p.N(e,r.transaction,t.oldVersion,this.version).next((()=>{Us("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.O(t);const e=bi.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).next((t=>(e.g(),t))).catch((t=>(e.abort(t),Ei.reject(t)))).toPromise();return i.catch((()=>{})),await e.m,i}catch(t){const e=t,n="FirebaseError"!==e.name&&i<3;if(Us("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ti{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return Ai(this.k.delete())}}class Ii extends Hs{constructor(t,e){super(Gs.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Si(t){return"IndexedDbTransactionError"===t.name}class Ci{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Us("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Us("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ai(n)}add(t){return Us("SimpleDb","ADD",this.store.name,t,t),Ai(this.store.add(t))}get(t){return Ai(this.store.get(t)).next((e=>(void 0===e&&(e=null),Us("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return Us("SimpleDb","DELETE",this.store.name,t),Ai(this.store.delete(t))}count(){return Us("SimpleDb","COUNT",this.store.name),Ai(this.store.count())}W(t,e){const n=this.options(t,e),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const t=r.getAll(n.range);return new Ei(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}{const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new Ei(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}H(t,e){Us("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.J=!1;const r=this.cursor(n);return this.G(r,((t,e,n)=>n.delete()))}Y(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.G(r,e)}Z(t){const e=this.cursor({});return new Ei(((n,r)=>{e.onerror=t=>{const e=Ni(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}G(t,e){const n=[];return new Ei(((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new Ti(s),o=e(s.primaryKey,s.value,i);if(o instanceof Ei){const t=o.catch((t=>(i.done(),Ei.reject(t))));n.push(t)}i.isDone?r():null===i.$?s.continue():s.continue(i.$)}})).next((()=>Ei.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.J?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Ai(t){return new Ei(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Ni(t.target.error);n(e)}}))}let Di=!1;function Ni(t){const e=_i.S(h());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Hs("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Di||(Di=!0,setTimeout((()=>{throw t}),0)),t}}return t}class ki{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function xi(t){return null==t}function Li(t){return 0===t&&1/t==-1/0}ki._e=-1;function Ri(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Oi(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Mi(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Pi{constructor(t,e){this.comparator=t,this.root=e||Fi.EMPTY}insert(t,e){return new Pi(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Fi.BLACK,null,null))}remove(t){return new Pi(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Fi.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Vi(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Vi(this.root,t,this.comparator,!1)}getReverseIterator(){return new Vi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Vi(this.root,t,this.comparator,!0)}}class Vi{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Fi{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:Fi.RED,this.left=null!=r?r:Fi.EMPTY,this.right=null!=s?s:Fi.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new Fi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Fi.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Fi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Fi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Fi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $s();if(this.right.isRed())throw $s();const t=this.left.check();if(t!==this.right.check())throw $s();return t+(this.isRed()?0:1)}}Fi.EMPTY=null,Fi.RED=!0,Fi.BLACK=!1,Fi.EMPTY=new class{constructor(){this.size=0}get key(){throw $s()}get value(){throw $s()}get color(){throw $s()}get left(){throw $s()}get right(){throw $s()}copy(t,e,n,r,s){return this}insert(t,e,n){return new Fi(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ui{constructor(t){this.comparator=t,this.data=new Pi(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Bi(this.data.getIterator())}getIteratorFrom(t){return new Bi(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ui))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ui(this.comparator);return e.data=t,e}}class Bi{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ji{constructor(t){this.fields=t,t.sort(di.comparator)}static empty(){return new ji([])}unionWith(t){let e=new Ui(di.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new ji(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return oi(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class qi extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class $i{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new qi("Invalid base64 string: "+t):t}}(t);return new $i(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new $i(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ii(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}$i.EMPTY_BYTE_STRING=new $i("");const zi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ki(t){if(zs(!!t),"string"==typeof t){let e=0;const n=zi.exec(t);if(zs(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Gi(t.seconds),nanos:Gi(t.nanos)}}function Gi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Hi(t){return"string"==typeof t?$i.fromBase64String(t):$i.fromUint8Array(t)}function Qi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Wi(t){const e=t.mapValue.fields.__previous_value__;return Qi(e)?Wi(e):e}function Xi(t){const e=Ki(t.mapValue.fields.__local_write_time__.timestampValue);return new ai(e.seconds,e.nanos)}class Yi{constructor(t,e,n,r,s,i,o,a,h){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=h}}class Ji{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Ji("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Ji&&t.projectId===this.projectId&&t.database===this.database}}const Zi={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function to(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Qi(t)?4:go(t)?9007199254740991:10:$s()}function eo(t,e){if(t===e)return!0;const n=to(t);if(n!==to(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Xi(t).isEqual(Xi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Ki(t.timestampValue),r=Ki(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Hi(t.bytesValue).isEqual(Hi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Gi(t.geoPointValue.latitude)===Gi(e.geoPointValue.latitude)&&Gi(t.geoPointValue.longitude)===Gi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Gi(t.integerValue)===Gi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Gi(t.doubleValue),r=Gi(e.doubleValue);return n===r?Li(n)===Li(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return oi(t.arrayValue.values||[],e.arrayValue.values||[],eo);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Ri(n)!==Ri(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!eo(n[t],r[t])))return!1;return!0}(t,e);default:return $s()}}function no(t,e){return void 0!==(t.values||[]).find((t=>eo(t,e)))}function ro(t,e){if(t===e)return 0;const n=to(t),r=to(e);if(n!==r)return ii(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ii(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Gi(t.integerValue||t.doubleValue),r=Gi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return so(t.timestampValue,e.timestampValue);case 4:return so(Xi(t),Xi(e));case 5:return ii(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Hi(t),r=Hi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=ii(n[t],r[t]);if(0!==e)return e}return ii(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=ii(Gi(t.latitude),Gi(e.latitude));return 0!==n?n:ii(Gi(t.longitude),Gi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=ro(n[t],r[t]);if(e)return e}return ii(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Zi.mapValue&&e===Zi.mapValue)return 0;if(t===Zi.mapValue)return 1;if(e===Zi.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=ii(r[t],i[t]);if(0!==e)return e;const o=ro(n[r[t]],s[i[t]]);if(0!==o)return o}return ii(r.length,i.length)}(t.mapValue,e.mapValue);default:throw $s()}}function so(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ii(t,e);const n=Ki(t),r=Ki(e),s=ii(n.seconds,r.seconds);return 0!==s?s:ii(n.nanos,r.nanos)}function io(t){return oo(t)}function oo(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Ki(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Hi(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return fi.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=oo(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${oo(t.fields[s])}`;return n+"}"}(t.mapValue):$s()}function ao(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function ho(t){return!!t&&"integerValue"in t}function co(t){return!!t&&"arrayValue"in t}function uo(t){return!!t&&"nullValue"in t}function lo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function fo(t){return!!t&&"mapValue"in t}function po(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Oi(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=po(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=po(t.arrayValue.values[n]);return e}return Object.assign({},t)}function go(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class mo{constructor(t){this.value=t}static empty(){return new mo({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!fo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=po(e)}setAll(t){let e=di.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=po(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());fo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return eo(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];fo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Oi(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new mo(po(this.value))}}class yo{constructor(t,e,n,r,s,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new yo(t,0,hi.min(),hi.min(),hi.min(),mo.empty(),0)}static newFoundDocument(t,e,n,r){return new yo(t,1,e,hi.min(),n,r,0)}static newNoDocument(t,e){return new yo(t,2,e,hi.min(),hi.min(),mo.empty(),0)}static newUnknownDocument(t,e){return new yo(t,3,e,hi.min(),hi.min(),mo.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(hi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=mo.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=mo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=hi.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof yo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new yo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class vo{constructor(t,e){this.position=t,this.inclusive=e}}function wo(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?fi.comparator(fi.fromName(o.referenceValue),n.key):ro(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Eo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!eo(t.position[n],e.position[n]))return!1;return!0}class bo{constructor(t,e="asc"){this.field=t,this.dir=e}}function _o(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class To{}class Io extends To{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new xo(t,e,n):"array-contains"===e?new Mo(t,n):"in"===e?new Po(t,n):"not-in"===e?new Vo(t,n):"array-contains-any"===e?new Fo(t,n):new Io(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Lo(t,n):new Ro(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(ro(e,this.value)):null!==e&&to(this.value)===to(e)&&this.matchesComparison(ro(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return $s()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class So extends To{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new So(t,e)}matches(t){return Co(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Co(t){return"and"===t.op}function Ao(t){return function(t){for(const e of t.filters)if(e instanceof So)return!1;return!0}(t)&&Co(t)}function Do(t){if(t instanceof Io)return t.field.canonicalString()+t.op.toString()+io(t.value);if(Ao(t))return t.filters.map((t=>Do(t))).join(",");{const e=t.filters.map((t=>Do(t))).join(",");return`${t.op}(${e})`}}function No(t,e){return t instanceof Io?function(t,e){return e instanceof Io&&t.op===e.op&&t.field.isEqual(e.field)&&eo(t.value,e.value)}(t,e):t instanceof So?function(t,e){return e instanceof So&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&No(n,e.filters[r])),!0)}(t,e):void $s()}function ko(t){return t instanceof Io?function(t){return`${t.field.canonicalString()} ${t.op} ${io(t.value)}`}(t):t instanceof So?function(t){return t.op.toString()+" {"+t.getFilters().map(ko).join(" ,")+"}"}(t):"Filter"}class xo extends Io{constructor(t,e,n){super(t,e,n),this.key=fi.fromName(n.referenceValue)}matches(t){const e=fi.comparator(t.key,this.key);return this.matchesComparison(e)}}class Lo extends Io{constructor(t,e){super(t,"in",e),this.keys=Oo(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Ro extends Io{constructor(t,e){super(t,"not-in",e),this.keys=Oo(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Oo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>fi.fromName(t.referenceValue)))}class Mo extends Io{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return co(e)&&no(e.arrayValue,this.value)}}class Po extends Io{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&no(this.value.arrayValue,e)}}class Vo extends Io{constructor(t,e){super(t,"not-in",e)}matches(t){if(no(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!no(this.value.arrayValue,e)}}class Fo extends Io{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!co(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>no(this.value.arrayValue,t)))}}class Uo{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ce=null}}function Bo(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Uo(t,e,n,r,s,i,o)}function jo(t){const e=Ks(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Do(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),xi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>io(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>io(t))).join(",")),e.ce=t}return e.ce}function qo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!_o(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!No(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Eo(t.startAt,e.startAt)&&Eo(t.endAt,e.endAt)}function $o(t){return fi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class zo{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function Ko(t){return new zo(t)}function Go(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Ho(t){return null!==t.collectionGroup}function Qo(t){const e=Ks(t);if(null===e.le){e.le=[];const t=new Set;for(const n of e.explicitOrderBy)e.le.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new Ui(di.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new bo(r,n))})),t.has(di.keyField().canonicalString())||e.le.push(new bo(di.keyField(),n))}return e.le}function Wo(t){const e=Ks(t);return e.he||(e.he=function(t,e){if("F"===t.limitType)return Bo(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new bo(t.field,e)}));const n=t.endAt?new vo(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new vo(t.startAt.position,t.startAt.inclusive):null;return Bo(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,Qo(t))),e.he}function Xo(t,e){const n=t.filters.concat([e]);return new zo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Yo(t,e,n){return new zo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Jo(t,e){return qo(Wo(t),Wo(e))&&t.limitType===e.limitType}function Zo(t){return`${jo(Wo(t))}|lt:${t.limitType}`}function ta(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>ko(t))).join(", ")}]`),xi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>io(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>io(t))).join(",")),`Target(${e})`}(Wo(t))}; limitType=${t.limitType})`}function ea(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):fi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Qo(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=wo(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Qo(t),e)||t.endAt&&!function(t,e,n){const r=wo(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Qo(t),e))}(t,e)}function na(t){return(e,n)=>{let r=!1;for(const s of Qo(t)){const t=ra(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function ra(t,e,n){const r=t.field.isKeyField()?fi.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?ro(r,s):$s()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return $s()}}class sa{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Oi(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return Mi(this.inner)}size(){return this.innerSize}}const ia=new Pi(fi.comparator);function oa(){return ia}const aa=new Pi(fi.comparator);function ha(...t){let e=aa;for(const n of t)e=e.insert(n.key,n);return e}function ca(t){let e=aa;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function ua(){return da()}function la(){return da()}function da(){return new sa((t=>t.toString()),((t,e)=>t.isEqual(e)))}new Pi(fi.comparator);const fa=new Ui(fi.comparator);function pa(...t){let e=fa;for(const n of t)e=e.add(n);return e}const ga=new Ui(ii);function ma(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Li(e)?"-0":e}}function ya(t){return{integerValue:""+t}}function va(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Li(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?ya(e):ma(t,e)}class wa{constructor(){this._=void 0}}function Ea(t,e,n){return t instanceof _a?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Qi(e)&&(e=Wi(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ta?Ia(t,e):t instanceof Sa?Ca(t,e):function(t,e){const n=function(t,e){return t instanceof Aa?function(t){return ho(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}(t,e),r=Da(n)+Da(t.Ie);return ho(n)&&ho(t.Ie)?ya(r):ma(t.serializer,r)}(t,e)}function ba(t,e,n){return t instanceof Ta?Ia(t,e):t instanceof Sa?Ca(t,e):n}class _a extends wa{}class Ta extends wa{constructor(t){super(),this.elements=t}}function Ia(t,e){const n=Na(e);for(const e of t.elements)n.some((t=>eo(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Sa extends wa{constructor(t){super(),this.elements=t}}function Ca(t,e){let n=Na(e);for(const e of t.elements)n=n.filter((t=>!eo(t,e)));return{arrayValue:{values:n}}}class Aa extends wa{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function Da(t){return Gi(t.integerValue||t.doubleValue)}function Na(t){return co(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class ka{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ka}static exists(t){return new ka(void 0,t)}static updateTime(t){return new ka(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function xa(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class La{}function Ra(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new qa(t.key,ka.none()):new Va(t.key,t.data,ka.none());{const n=t.data,r=mo.empty();let s=new Ui(di.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new Fa(t.key,r,new ji(s.toArray()),ka.none())}}function Oa(t,e,n){t instanceof Va?function(t,e,n){const r=t.value.clone(),s=Ba(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Fa?function(t,e,n){if(!xa(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Ba(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Ua(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ma(t,e,n,r){return t instanceof Va?function(t,e,n,r){if(!xa(t.precondition,e))return n;const s=t.value.clone(),i=ja(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof Fa?function(t,e,n,r){if(!xa(t.precondition,e))return n;const s=ja(t.fieldTransforms,r,e),i=e.data;return i.setAll(Ua(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return xa(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Pa(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&oi(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ta&&e instanceof Ta||t instanceof Sa&&e instanceof Sa?oi(t.elements,e.elements,eo):t instanceof Aa&&e instanceof Aa?eo(t.Ie,e.Ie):t instanceof _a&&e instanceof _a}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Va extends La{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Fa extends La{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ua(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Ba(t,e,n){const r=new Map;zs(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,ba(o,a,n[s]))}return r}function ja(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,Ea(t,i,e))}return r}class qa extends La{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class $a{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Oa(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Ma(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Ma(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=la();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=Ra(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(hi.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),pa())}isEqual(t){return this.batchId===t.batchId&&oi(this.mutations,t.mutations,((t,e)=>Pa(t,e)))&&oi(this.baseMutations,t.baseMutations,((t,e)=>Pa(t,e)))}}class za{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ka{constructor(t,e){this.count=t,this.unchangedNames=e}}var Ga,Ha;function Qa(t){if(void 0===t)return Bs("GRPC error has no .code"),Gs.UNKNOWN;switch(t){case Ga.OK:return Gs.OK;case Ga.CANCELLED:return Gs.CANCELLED;case Ga.UNKNOWN:return Gs.UNKNOWN;case Ga.DEADLINE_EXCEEDED:return Gs.DEADLINE_EXCEEDED;case Ga.RESOURCE_EXHAUSTED:return Gs.RESOURCE_EXHAUSTED;case Ga.INTERNAL:return Gs.INTERNAL;case Ga.UNAVAILABLE:return Gs.UNAVAILABLE;case Ga.UNAUTHENTICATED:return Gs.UNAUTHENTICATED;case Ga.INVALID_ARGUMENT:return Gs.INVALID_ARGUMENT;case Ga.NOT_FOUND:return Gs.NOT_FOUND;case Ga.ALREADY_EXISTS:return Gs.ALREADY_EXISTS;case Ga.PERMISSION_DENIED:return Gs.PERMISSION_DENIED;case Ga.FAILED_PRECONDITION:return Gs.FAILED_PRECONDITION;case Ga.ABORTED:return Gs.ABORTED;case Ga.OUT_OF_RANGE:return Gs.OUT_OF_RANGE;case Ga.UNIMPLEMENTED:return Gs.UNIMPLEMENTED;case Ga.DATA_LOSS:return Gs.DATA_LOSS;default:return $s()}}(Ha=Ga||(Ga={}))[Ha.OK=0]="OK",Ha[Ha.CANCELLED=1]="CANCELLED",Ha[Ha.UNKNOWN=2]="UNKNOWN",Ha[Ha.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ha[Ha.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ha[Ha.NOT_FOUND=5]="NOT_FOUND",Ha[Ha.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ha[Ha.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ha[Ha.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ha[Ha.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ha[Ha.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ha[Ha.ABORTED=10]="ABORTED",Ha[Ha.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ha[Ha.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ha[Ha.INTERNAL=13]="INTERNAL",Ha[Ha.UNAVAILABLE=14]="UNAVAILABLE",Ha[Ha.DATA_LOSS=15]="DATA_LOSS";const Wa=new Rs([4294967295,4294967295],0);function Xa(t){const e=(new TextEncoder).encode(t),n=new Ls;return n.update(e),new Uint8Array(n.digest())}function Ya(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Rs([n,r],0),new Rs([s,i],0)]}class Ja{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Za(`Invalid padding: ${e}`);if(n<0)throw new Za(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Za(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Za(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=Rs.fromNumber(this.Te)}de(t,e,n){let r=t.add(e.multiply(Rs.fromNumber(n)));return 1===r.compare(Wa)&&(r=new Rs([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=Xa(t),[n,r]=Ya(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);if(!this.Ae(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new Ja(s,r,e);return n.forEach((t=>i.insert(t))),i}insert(t){if(0===this.Te)return;const e=Xa(t),[n,r]=Ya(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);this.Re(e)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Za extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class th{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,eh.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new th(hi.min(),r,new Pi(ii),oa(),pa())}}class eh{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new eh(n,e,pa(),pa(),pa())}}class nh{constructor(t,e,n,r){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=r}}class rh{constructor(t,e){this.targetId=t,this.fe=e}}class sh{constructor(t,e,n=$i.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class ih{constructor(){this.ge=0,this.pe=hh(),this.ye=$i.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=pa(),e=pa(),n=pa();return this.pe.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:$s()}})),new eh(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=hh()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,zs(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class oh{constructor(t){this.Le=t,this.ke=new Map,this.qe=oa(),this.Qe=ah(),this.Ke=new Pi(ii)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Be(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:$s()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,r=this.Ye(e);if(r){const s=r.target;if($o(s))if(0===n){const t=new fi(s.path);this.We(e,t,yo.newNoDocument(t,hi.min()))}else zs(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),s=n?this.et(n,t,r):1;if(0!==s){this.He(e);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=e;let i,o;try{i=Hi(n).toUint8Array()}catch(t){if(t instanceof qi)return js("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new Ja(i,r,s)}catch(t){return js(t instanceof Za?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const s=this.Le.nt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;t.mightContain(i)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.ke.forEach(((n,r)=>{const s=this.Ye(r);if(s){if(n.current&&$o(s.target)){const e=new fi(s.target.path);null!==this.qe.get(e)||this.st(r,e)||this.We(r,e,yo.newNoDocument(e,t))}n.De&&(e.set(r,n.ve()),n.Fe())}}));let n=pa();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const r=new th(t,e,this.Ke,this.qe,n);return this.qe=oa(),this.Qe=ah(),this.Ke=new Pi(ii),r}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new ih,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new Ui(ii),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||Us("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Le._t(t)}He(t){this.ke.set(t,new ih),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function ah(){return new Pi(fi.comparator)}function hh(){return new Pi(fi.comparator)}const ch={asc:"ASCENDING",desc:"DESCENDING"},uh={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},lh={and:"AND",or:"OR"};class dh{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function fh(t,e){return t.useProto3Json||xi(e)?e:{value:e}}function ph(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function gh(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function mh(t){return zs(!!t),hi.fromTimestamp(function(t){const e=Ki(t);return new ai(e.seconds,e.nanos)}(t))}function yh(t,e){return vh(t,e).canonicalString()}function vh(t,e){const n=function(t){return new ui(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function wh(t){const e=ui.fromString(t);return zs(Oh(e)),e}function Eh(t,e){const n=wh(e);if(n.get(1)!==t.databaseId.projectId)throw new Hs(Gs.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Hs(Gs.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new fi(Th(n))}function bh(t,e){return yh(t.databaseId,e)}function _h(t){return new ui(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Th(t){return zs(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ih(t,e){return{documents:[bh(t,e.path)]}}function Sh(t,e){const n={structuredQuery:{}},r=e.path;let s;null!==e.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=bh(t,s);const i=function(t){if(0!==t.length)return Rh(So.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:xh(t.field),direction:Dh(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=fh(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ut:n,parent:s}}function Ch(t){let e=function(t){const e=wh(t);return 4===e.length?ui.emptyPath():Th(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){zs(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=Ah(t);return e instanceof So&&Ao(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new bo(Lh(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,xi(e)?null:e}(n.limit));let h=null;n.startAt&&(h=function(t){const e=!!t.before,n=t.values||[];return new vo(n,e)}(n.startAt));let c=null;return n.endAt&&(c=function(t){const e=!t.before,n=t.values||[];return new vo(n,e)}(n.endAt)),function(t,e,n,r,s,i,o,a){return new zo(t,e,n,r,s,i,o,a)}(e,s,o,i,a,"F",h,c)}function Ah(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Lh(t.unaryFilter.field);return Io.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Lh(t.unaryFilter.field);return Io.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Lh(t.unaryFilter.field);return Io.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Lh(t.unaryFilter.field);return Io.create(s,"!=",{nullValue:"NULL_VALUE"});default:return $s()}}(t):void 0!==t.fieldFilter?function(t){return Io.create(Lh(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return $s()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return So.create(t.compositeFilter.filters.map((t=>Ah(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return $s()}}(t.compositeFilter.op))}(t):$s()}function Dh(t){return ch[t]}function Nh(t){return uh[t]}function kh(t){return lh[t]}function xh(t){return{fieldPath:t.canonicalString()}}function Lh(t){return di.fromServerFormat(t.fieldPath)}function Rh(t){return t instanceof Io?function(t){if("=="===t.op){if(lo(t.value))return{unaryFilter:{field:xh(t.field),op:"IS_NAN"}};if(uo(t.value))return{unaryFilter:{field:xh(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(lo(t.value))return{unaryFilter:{field:xh(t.field),op:"IS_NOT_NAN"}};if(uo(t.value))return{unaryFilter:{field:xh(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xh(t.field),op:Nh(t.op),value:t.value}}}(t):t instanceof So?function(t){const e=t.getFilters().map((t=>Rh(t)));return 1===e.length?e[0]:{compositeFilter:{op:kh(t.op),filters:e}}}(t):$s()}function Oh(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Mh{constructor(t,e,n,r,s=hi.min(),i=hi.min(),o=$i.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Mh(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Mh(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Mh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Mh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Ph{constructor(t){this.ct=t}}function Vh(t){const e=Ch({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Yo(e,e.limit,"L"):e}class Fh{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(Gi(t.integerValue));else if("doubleValue"in t){const n=Gi(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),Li(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Et(e,20),"string"==typeof n?e.At(n):(e.At(`${n.seconds||""}`),e.dt(n.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Hi(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?go(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):$s()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),fi.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}Fh.bt=new Fh;class Uh{constructor(){this._n=new Bh}addToCollectionParentIndex(t,e){return this._n.add(e),Ei.resolve()}getCollectionParents(t,e){return Ei.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return Ei.resolve()}deleteFieldIndex(t,e){return Ei.resolve()}deleteAllFieldIndexes(t){return Ei.resolve()}createTargetIndexes(t,e){return Ei.resolve()}getDocumentsMatchingTarget(t,e){return Ei.resolve(null)}getIndexType(t,e){return Ei.resolve(0)}getFieldIndexes(t,e){return Ei.resolve([])}getNextCollectionGroupToUpdate(t){return Ei.resolve(null)}getMinOffset(t,e){return Ei.resolve(gi.min())}getMinOffsetFromCollectionGroup(t,e){return Ei.resolve(gi.min())}updateCollectionGroup(t,e,n){return Ei.resolve()}updateIndexEntries(t,e){return Ei.resolve()}}class Bh{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ui(ui.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Ui(ui.comparator)).toArray()}}new Uint8Array(0);class jh{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new jh(t,jh.DEFAULT_COLLECTION_PERCENTILE,jh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}jh.DEFAULT_COLLECTION_PERCENTILE=10,jh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,jh.DEFAULT=new jh(41943040,jh.DEFAULT_COLLECTION_PERCENTILE,jh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),jh.DISABLED=new jh(-1,0,0);class qh{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new qh(0)}static Bn(){return new qh(-1)}}class $h{constructor(){this.changes=new sa((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,yo.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Ei.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class zh{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Kh{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Ma(n.mutation,t,ji.empty(),ai.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,pa()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=pa()){const r=ua();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=ha();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=ua();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,pa())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=oa();const i=da(),o=da();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Fa)?s=s.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),Ma(o.mutation,e,o.mutation.getFieldMask(),ai.now())):i.set(e.key,ji.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new zh(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=da();let r=new Pi(((t,e)=>t-e)),s=pa();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||ji.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||pa()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,h=r.value,c=la();h.forEach((t=>{if(!s.has(t)){const r=Ra(e.get(t),n.get(t));null!==r&&c.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,c))}return Ei.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return fi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Ho(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):Ei.resolve(ua());let o=-1,a=s;return i.next((e=>Ei.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?Ei.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,pa()))).next((t=>({batchId:o,changes:ca(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new fi(e)).next((t=>{let e=ha();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const s=e.collectionGroup;let i=ha();return this.indexManager.getCollectionParents(t,s).next((o=>Ei.forEach(o,(o=>{const a=function(t,e){return new zo(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(s));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,r)))).next((t=>{s.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,yo.newInvalidDocument(r)))}));let n=ha();return t.forEach(((t,r)=>{const i=s.get(t);void 0!==i&&Ma(i.mutation,r,ji.empty(),ai.now()),ea(e,r)&&(n=n.insert(t,r))})),n}))}}class Gh{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return Ei.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:mh(t.createTime)}}(e)),Ei.resolve()}getNamedQuery(t,e){return Ei.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:Vh(t.bundledQuery),readTime:mh(t.readTime)}}(e)),Ei.resolve()}}class Hh{constructor(){this.overlays=new Pi(fi.comparator),this.hr=new Map}getOverlay(t,e){return Ei.resolve(this.overlays.get(e))}getOverlays(t,e){const n=ua();return Ei.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),Ei.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),Ei.resolve()}getOverlaysForCollection(t,e,n){const r=ua(),s=e.length+1,i=new fi(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Ei.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new Pi(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=ua(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=ua(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return Ei.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new za(e,n));let s=this.hr.get(e);void 0===s&&(s=pa(),this.hr.set(e,s)),this.hr.set(e,s.add(n.key))}}class Qh{constructor(){this.Pr=new Ui(Wh.Ir),this.Tr=new Ui(Wh.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new Wh(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new Wh(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new fi(new ui([])),n=new Wh(e,t),r=new Wh(e,t+1),s=[];return this.Tr.forEachInRange([n,r],(t=>{this.Ar(t),s.push(t.key)})),s}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new fi(new ui([])),n=new Wh(e,t),r=new Wh(e,t+1);let s=pa();return this.Tr.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new Wh(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Wh{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return fi.comparator(t.key,e.key)||ii(t.pr,e.pr)}static Er(t,e){return ii(t.pr,e.pr)||fi.comparator(t.key,e.key)}}class Xh{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new Ui(Wh.Ir)}checkEmpty(t){return Ei.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new $a(s,e,n,r);this.mutationQueue.push(i);for(const e of r)this.wr=this.wr.add(new Wh(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Ei.resolve(i)}lookupMutationBatch(t,e){return Ei.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.br(n),s=r<0?0:r;return Ei.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Ei.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return Ei.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Wh(e,0),r=new Wh(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,r],(t=>{const e=this.Sr(t.pr);s.push(e)})),Ei.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ui(ii);return e.forEach((t=>{const e=new Wh(t,0),r=new Wh(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,r],(t=>{n=n.add(t.pr)}))})),Ei.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;fi.isDocumentKey(s)||(s=s.child(""));const i=new Wh(new fi(s),0);let o=new Ui(ii);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.pr)),!0)}),i),Ei.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){zs(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Ei.forEach(e.mutations,(r=>{const s=new Wh(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new Wh(e,0),r=this.wr.firstAfterOrEqual(n);return Ei.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Ei.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Yh{constructor(t){this.vr=t,this.docs=new Pi(fi.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Ei.resolve(n?n.document.mutableCopy():yo.newInvalidDocument(e))}getEntries(t,e){let n=oa();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():yo.newInvalidDocument(t))})),Ei.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let s=oa();const i=e.path,o=new fi(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||mi(pi(o),n)<=0||(r.has(o.key)||ea(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Ei.resolve(s)}getAllFromCollectionGroup(t,e,n,r){$s()}Fr(t,e){return Ei.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Jh(this)}getSize(t){return Ei.resolve(this.size)}}class Jh extends $h{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(n)})),Ei.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class Zh{constructor(t){this.persistence=t,this.Mr=new sa((t=>jo(t)),qo),this.lastRemoteSnapshotVersion=hi.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Qh,this.targetCount=0,this.Br=qh.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),Ei.resolve()}getLastRemoteSnapshotVersion(t){return Ei.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ei.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Br.next(),Ei.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),Ei.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Br=new qh(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,Ei.resolve()}updateTargetData(t,e){return this.qn(e),Ei.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,Ei.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Mr.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Ei.waitFor(s).next((()=>r))}getTargetCount(t){return Ei.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return Ei.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),Ei.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),Ei.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),Ei.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return Ei.resolve(n)}containsKey(t,e){return Ei.resolve(this.Nr.containsKey(e))}}class tc{constructor(t,e){this.Lr={},this.overlays={},this.kr=new ki(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Zh(this),this.indexManager=new Uh,this.remoteDocumentCache=function(t){return new Yh(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new Ph(e),this.$r=new Gh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Hh,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Lr[t.toKey()];return n||(n=new Xh(e,this.referenceDelegate),this.Lr[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){Us("MemoryPersistence","Starting transaction:",t);const r=new ec(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((t=>this.referenceDelegate.Wr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gr(t,e){return Ei.or(Object.values(this.Lr).map((n=>()=>n.containsKey(t,e))))}}class ec extends vi{constructor(t){super(),this.currentSequenceNumber=t}}class nc{constructor(t){this.persistence=t,this.zr=new Qh,this.jr=null}static Hr(t){return new nc(t)}get Jr(){if(this.jr)return this.jr;throw $s()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),Ei.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),Ei.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),Ei.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ei.forEach(this.Jr,(n=>{const r=fi.fromPath(n);return this.Yr(t,r).next((t=>{t||e.removeEntry(r,hi.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return Ei.or([()=>Ei.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class rc{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=r}static Ki(t,e){let n=pa(),r=pa();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new rc(t,e.fromCache,n,r)}}class sc{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class ic{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){var e;const n=null===(e=i())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()||!navigator.userAgent.includes("Safari")||navigator.userAgent.includes("Chrome")?_i.v(h())>0?6:4:8}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,r){const s={result:null};return this.ji(t,e).next((t=>{s.result=t})).next((()=>{if(!s.result)return this.Hi(t,e,r,n).next((t=>{s.result=t}))})).next((()=>{if(s.result)return;const n=new sc;return this.Ji(t,e,n).next((r=>{if(s.result=r,this.Ui)return this.Yi(t,e,n,r.size)}))})).next((()=>s.result))}Yi(t,e,n,r){return n.documentReadCount<this.Wi?(Fs()<=b.DEBUG&&Us("QueryEngine","SDK will not create cache indexes for query:",ta(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Ei.resolve()):(Fs()<=b.DEBUG&&Us("QueryEngine","Query:",ta(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Fs()<=b.DEBUG&&Us("QueryEngine","The SDK decides to create cache indexes for query:",ta(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Wo(e))):Ei.resolve())}ji(t,e){if(Go(e))return Ei.resolve(null);let n=Wo(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Yo(e,null,"F"),n=Wo(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=pa(...r);return this.zi.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.Zi(e,r);return this.Xi(e,i,s,n.readTime)?this.ji(t,Yo(e,null,"F")):this.es(t,i,e,n)}))))})))))}Hi(t,e,n,r){return Go(e)||r.isEqual(hi.min())?Ei.resolve(null):this.zi.getDocuments(t,n).next((s=>{const i=this.Zi(e,s);return this.Xi(e,i,n,r)?Ei.resolve(null):(Fs()<=b.DEBUG&&Us("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ta(e)),this.es(t,i,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=hi.fromTimestamp(1e9===r?new ai(n+1,0):new ai(n,r));return new gi(s,fi.empty(),e)}(r,-1)).next((t=>t)))}))}Zi(t,e){let n=new Ui(na(t));return e.forEach(((e,r)=>{ea(t,r)&&(n=n.add(r))})),n}Xi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ji(t,e,n){return Fs()<=b.DEBUG&&Us("QueryEngine","Using full collection scan to execute query:",ta(e)),this.zi.getDocumentsMatchingQuery(t,e,gi.min(),n)}es(t,e,n,r){return this.zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class oc{constructor(t,e,n,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new Pi(ii),this.rs=new sa((t=>jo(t)),qo),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Kh(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}async function ac(t,e){const n=Ks(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=pa();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function hc(t){const e=Ks(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}async function cc(t,e,n){const r=Ks(t),s=r.ns.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Si(t))throw t;Us("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ns=r.ns.remove(e),r.rs.delete(s.target)}function uc(t,e,n){const r=Ks(t);let s=hi.min(),i=pa();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=Ks(t),s=r.rs.get(n);return void 0!==s?Ei.resolve(r.ns.get(s)):r.Qr.getTargetData(e,n)}(r,t,Wo(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.ts.getDocumentsMatchingQuery(t,e,n?s:hi.min(),n?i:pa()))).next((t=>(function(t,e,n){let r=t.ss.get(e)||hi.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ss.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,hs:i})))))}class lc{constructor(){this.activeTargetIds=ga}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class dc{constructor(){this.no=new lc,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new lc,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class fc{io(t){}shutdown(){}}class pc{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){Us("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){Us("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let gc=null;function mc(){return null===gc?gc=268435456+Math.round(2147483648*Math.random()):gc++,"0x"+gc.toString(16)}const yc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class vc{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}}const wc="WebChannelConnection";class Ec extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=e+"://"+t.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(t,e,n,r,s){const i=mc(),o=this.bo(t,e.toUriEncodedString());Us("RestConnection",`Sending RPC '${t}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,s),this.Co(t,o,a,n).then((e=>(Us("RestConnection",`Received RPC '${t}' ${i}: `,e),e)),(e=>{throw js("RestConnection",`RPC '${t}' ${i} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,r,s,i){return this.So(t,e,n,r,s)}Do(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Ps,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}bo(t,e){const n=yc[t];return`${this.fo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,n,r){const s=mc();return new Promise(((i,o)=>{const a=new xs;a.setWithCredentials(!0),a.listenOnce(As.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Cs.NO_ERROR:const e=a.getResponseJson();Us(wc,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case Cs.TIMEOUT:Us(wc,`RPC '${t}' ${s} timed out`),o(new Hs(Gs.DEADLINE_EXCEEDED,"Request time out"));break;case Cs.HTTP_ERROR:const n=a.getStatus();if(Us(wc,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Gs).indexOf(e)>=0?e:Gs.UNKNOWN}(e.status);o(new Hs(t,e.message))}else o(new Hs(Gs.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Hs(Gs.UNAVAILABLE,"Connection failed."));break;default:$s()}}finally{Us(wc,`RPC '${t}' ${s} completed.`)}}));const h=JSON.stringify(r);Us(wc,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",h,n,15)}))}Fo(t,e,n){const r=mc(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Is(),o=Ss(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(a.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const c=s.join("");Us(wc,`Creating RPC '${t}' stream ${r}: ${c}`,a);const u=i.createWebChannel(c,a);let l=!1,d=!1;const f=new vc({lo:e=>{d?Us(wc,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(Us(wc,`Opening RPC '${t}' stream ${r} transport.`),u.open(),l=!0),Us(wc,`RPC '${t}' stream ${r} sending:`,e),u.send(e))},ho:()=>u.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(u,ks.EventType.OPEN,(()=>{d||Us(wc,`RPC '${t}' stream ${r} transport opened.`)})),p(u,ks.EventType.CLOSE,(()=>{d||(d=!0,Us(wc,`RPC '${t}' stream ${r} transport closed`),f.Vo())})),p(u,ks.EventType.ERROR,(e=>{d||(d=!0,js(wc,`RPC '${t}' stream ${r} transport errored:`,e),f.Vo(new Hs(Gs.UNAVAILABLE,"The operation could not be completed")))})),p(u,ks.EventType.MESSAGE,(e=>{var n;if(!d){const s=e.data[0];zs(!!s);const i=s,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){Us(wc,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Ga[t];if(void 0!==e)return Qa(e)}(e),s=o.message;void 0===n&&(n=Gs.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.Vo(new Hs(n,s)),u.close()}else Us(wc,`RPC '${t}' stream ${r} received:`,s),f.mo(s)}})),p(o,Ds.STAT_EVENT,(e=>{e.stat===Ns.PROXY?Us(wc,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Ns.NOPROXY&&Us(wc,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function bc(){return"undefined"!=typeof document?document:null}function _c(t){return new dh(t,!0)}class Tc{constructor(t,e,n=1e3,r=1.5,s=6e4){this.oi=t,this.timerId=e,this.Mo=n,this.xo=r,this.Oo=s,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();const e=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,e-n);r>0&&Us("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Lo=Date.now(),t()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class Ic{constructor(t,e,n,r,s,i,o,a){this.oi=t,this.$o=n,this.Uo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Tc(t,e)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(t){this.n_(),this.stream.send(t)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(t,e){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==t?this.jo.reset():e&&e.code===Gs.RESOURCE_EXHAUSTED?(Bs(e.toString()),Bs("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===Gs.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.To(e)}i_(){}auth(){this.state=1;const t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Wo===e&&this.o_(t,n)}),(e=>{t((()=>{const t=new Hs(Gs.UNKNOWN,"Fetching auth token failed: "+e.message);return this.__(t)}))}))}o_(t,e){const n=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((t=>{n((()=>this.__(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(t){return Us("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget((()=>this.Wo===t?e():(Us("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Sc extends Ic{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:$s()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(zs(void 0===e||"string"==typeof e),$i.fromBase64String(e||"")):(zs(void 0===e||e instanceof Uint8Array),$i.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Gs.UNKNOWN:Qa(t.code);return new Hs(e,t.message||"")}(o);n=new sh(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Eh(t,r.document.name),i=mh(r.document.updateTime),o=r.document.createTime?mh(r.document.createTime):hi.min(),a=new mo({mapValue:{fields:r.document.fields}}),h=yo.newFoundDocument(s,i,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];n=new nh(c,u,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Eh(t,r.document),i=r.readTime?mh(r.readTime):hi.min(),o=yo.newNoDocument(s,i),a=r.removedTargetIds||[];n=new nh([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Eh(t,r.document),i=r.removedTargetIds||[];n=new nh([],i,s,null)}else{if(!("filter"in e))return $s();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:s}=t,i=new Ka(r,s),o=t.targetId;n=new rh(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return hi.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?hi.min():e.readTime?mh(e.readTime):hi.min()}(t);return this.listener.u_(e,n)}c_(t){const e={};e.database=_h(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=$o(r)?{documents:Ih(t,r)}:{query:Sh(t,r).ut},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=gh(t,e.resumeToken);const r=fh(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(hi.min())>0){n.readTime=ph(t,e.snapshotVersion.toTimestamp());const r=fh(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $s()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.t_(e)}l_(t){const e={};e.database=_h(this.serializer),e.removeTarget=t,this.t_(e)}}class Cc extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new Hs(Gs.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.So(t,vh(e,n),r,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Gs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Hs(Gs.UNKNOWN,t.toString())}))}vo(t,e,n,r,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.vo(t,vh(e,n),r,i,o,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Gs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Hs(Gs.UNKNOWN,t.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class Ac{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(t){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,"Online"===t&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Bs(e),this.g_=!1):Us("OnlineStateTracker",e)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Dc{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io((t=>{n.enqueueAndForget((async()=>{Vc(this)&&(Us("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Ks(t);e.v_.add(4),await kc(e),e.x_.set("Unknown"),e.v_.delete(4),await Nc(e)}(this))}))})),this.x_=new Ac(n,r)}}async function Nc(t){if(Vc(t))for(const e of t.F_)await e(!0)}async function kc(t){for(const e of t.F_)await e(!1)}function xc(t,e){const n=Ks(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),Pc(n)?Mc(n):zc(n).Jo()&&Rc(n,e))}function Lc(t,e){const n=Ks(t),r=zc(n);n.C_.delete(e),r.Jo()&&Oc(n,e),0===n.C_.size&&(r.Jo()?r.Xo():Vc(n)&&n.x_.set("Unknown"))}function Rc(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(hi.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}zc(t).c_(e)}function Oc(t,e){t.O_.Oe(e),zc(t).l_(e)}function Mc(t){t.O_=new oh({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),zc(t).start(),t.x_.p_()}function Pc(t){return Vc(t)&&!zc(t).Ho()&&t.C_.size>0}function Vc(t){return 0===Ks(t).v_.size}function Fc(t){t.O_=void 0}async function Uc(t){t.C_.forEach(((e,n)=>{Rc(t,e)}))}async function Bc(t,e){Fc(t),Pc(t)?(t.x_.S_(e),Mc(t)):t.x_.set("Unknown")}async function jc(t,e,n){if(t.x_.set("Online"),e instanceof sh&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.C_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.C_.delete(r),t.O_.removeTarget(r))}(t,e)}catch(n){Us("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await qc(t,n)}else if(e instanceof nh?t.O_.$e(e):e instanceof rh?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(hi.min()))try{const e=await hc(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.O_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.C_.get(r);s&&t.C_.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.C_.get(e);if(!r)return;t.C_.set(e,r.withResumeToken($i.EMPTY_BYTE_STRING,r.snapshotVersion)),Oc(t,e);const s=new Mh(r.target,e,n,r.sequenceNumber);Rc(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Us("RemoteStore","Failed to raise snapshot:",e),await qc(t,e)}}async function qc(t,e,n){if(!Si(e))throw e;t.v_.add(1),await kc(t),t.x_.set("Offline"),n||(n=()=>hc(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Us("RemoteStore","Retrying IndexedDB access"),await n(),t.v_.delete(1),await Nc(t)}))}async function $c(t,e){const n=Ks(t);n.asyncQueue.verifyOperationInProgress(),Us("RemoteStore","RemoteStore received new credentials");const r=Vc(n);n.v_.add(3),await kc(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),await Nc(n)}function zc(t){return t.N_||(t.N_=function(t,e,n){const r=Ks(t);return r.R_(),new Sc(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:Uc.bind(null,t),To:Bc.bind(null,t),u_:jc.bind(null,t)}),t.F_.push((async e=>{e?(t.N_.Zo(),Pc(t)?Mc(t):t.x_.set("Unknown")):(await t.N_.stop(),Fc(t))}))),t.N_}class Kc{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new Qs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new Kc(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Hs(Gs.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gc(t,e){if(Bs("AsyncQueue",`${e}: ${t}`),Si(t))return new Hs(Gs.UNAVAILABLE,`${e}: ${t}`);throw t}class Hc{constructor(t){this.comparator=t?(e,n)=>t(e,n)||fi.comparator(e.key,n.key):(t,e)=>fi.comparator(t.key,e.key),this.keyedMap=ha(),this.sortedSet=new Pi(this.comparator)}static emptySet(t){return new Hc(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Hc))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Hc;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Qc{constructor(){this.L_=new Pi(fi.comparator)}track(t){const e=t.doc.key,n=this.L_.get(e);n?0!==t.type&&3===n.type?this.L_=this.L_.insert(e,t):3===t.type&&1!==n.type?this.L_=this.L_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.L_=this.L_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.L_=this.L_.remove(e):1===t.type&&2===n.type?this.L_=this.L_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):$s():this.L_=this.L_.insert(e,t)}k_(){const t=[];return this.L_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Wc{constructor(t,e,n,r,s,i,o,a,h){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=h}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new Wc(t,e,Hc.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Jo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Xc{constructor(){this.q_=void 0,this.Q_=[]}}class Yc{constructor(){this.queries=new sa((t=>Zo(t)),Jo),this.onlineState="Unknown",this.K_=new Set}}function Jc(t,e){const n=Ks(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.Q_)e.W_(t)&&(r=!0);s.q_=t}}r&&tu(n)}function Zc(t,e,n){const r=Ks(t),s=r.queries.get(e);if(s)for(const t of s.Q_)t.onError(n);r.queries.delete(e)}function tu(t){t.K_.forEach((t=>{t.next()}))}class eu{constructor(t,e,n){this.query=t,this.G_=e,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Wc(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.z_?this.H_(t)&&(this.G_.next(t),e=!0):this.J_(t,this.onlineState)&&(this.Y_(t),e=!0),this.j_=t,e}onError(t){this.G_.error(t)}U_(t){this.onlineState=t;let e=!1;return this.j_&&!this.z_&&this.J_(this.j_,t)&&(this.Y_(this.j_),e=!0),e}J_(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Z_||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}H_(t){if(t.docChanges.length>0)return!0;const e=this.j_&&this.j_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Y_(t){t=Wc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.z_=!0,this.G_.next(t)}}class nu{constructor(t){this.key=t}}class ru{constructor(t){this.key=t}}class su{constructor(t,e){this.query=t,this.oa=e,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=pa(),this.mutatedKeys=pa(),this.ua=na(t),this.ca=new Hc(this.ua)}get la(){return this.oa}ha(t,e){const n=e?e.Pa:new Qc,r=e?e.ca:this.ca;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,h="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const c=r.get(t),u=ea(this.query,e)?e:null,l=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;c&&u?c.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this.Ia(c,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.ua(u,a)>0||h&&this.ua(u,h)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),f=!0):c&&!u&&(n.track({type:1,doc:c}),f=!0,(a||h)&&(o=!0)),f&&(u?(i=i.add(u),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{ca:i,Pa:n,Xi:o,mutatedKeys:s}}Ia(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const s=this.ca;this.ca=t.ca,this.mutatedKeys=t.mutatedKeys;const i=t.Pa.k_();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $s()}};return n(t)-n(e)}(t.type,e.type)||this.ua(t.doc,e.doc))),this.Ta(n),r=null!=r&&r;const o=e&&!r?this.Ea():[],a=0===this.aa.size&&this.current&&!r?1:0,h=a!==this._a;return this._a=a,0!==i.length||h?{snapshot:new Wc(this.query,t.ca,s,i,t.mutatedKeys,0===a,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:o}:{da:o}}U_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new Qc,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(t){return!this.oa.has(t)&&!!this.ca.has(t)&&!this.ca.get(t).hasLocalMutations}Ta(t){t&&(t.addedDocuments.forEach((t=>this.oa=this.oa.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.oa=this.oa.delete(t))),this.current=t.current)}Ea(){if(!this.current)return[];const t=this.aa;this.aa=pa(),this.ca.forEach((t=>{this.Aa(t.key)&&(this.aa=this.aa.add(t.key))}));const e=[];return t.forEach((t=>{this.aa.has(t)||e.push(new ru(t))})),this.aa.forEach((n=>{t.has(n)||e.push(new nu(n))})),e}Ra(t){this.oa=t.hs,this.aa=pa();const e=this.ha(t.documents);return this.applyChanges(e,!0)}Va(){return Wc.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class iu{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class ou{constructor(t){this.key=t,this.ma=!1}}class au{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.fa={},this.ga=new sa((t=>Zo(t)),Jo),this.pa=new Map,this.ya=new Set,this.wa=new Pi(fi.comparator),this.Sa=new Map,this.ba=new Qh,this.Da={},this.Ca=new Map,this.va=qh.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function hu(t,e){const n=function(t){const e=Ks(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=uu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Eu.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=du.bind(null,e),e.fa.u_=Jc.bind(null,e.eventManager),e.fa.xa=Zc.bind(null,e.eventManager),e}(t);let r,s;const i=n.ga.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Va();else{const t=await function(t,e){const n=Ks(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Qr.getTargetData(t,e).next((s=>s?(r=s,Ei.resolve(r)):n.Qr.allocateTargetId(t).next((s=>(r=new Mh(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ns.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}(n.localStore,Wo(e)),i=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,s=await async function(t,e,n,r,s){t.Ma=(e,n,r)=>async function(t,e,n,r){let s=e.view.ha(n);s.Xi&&(s=await uc(t.localStore,e.query,!1).then((({documents:t})=>e.view.ha(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(s,t.isPrimaryClient,i,o);return gu(t,e.targetId,a.da),a.snapshot}(t,e,n,r);const i=await uc(t.localStore,e,!0),o=new su(e,i.hs),a=o.ha(i.documents),h=eh.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),c=o.applyChanges(a,t.isPrimaryClient,h);gu(t,n,c.da);const u=new iu(e,n,o);return t.ga.set(e,u),t.pa.has(n)?t.pa.get(n).push(e):t.pa.set(n,[e]),c.snapshot}(n,e,r,"current"===i,t.resumeToken),n.isPrimaryClient&&xc(n.remoteStore,t)}return s}async function cu(t,e){const n=Ks(t),r=n.ga.get(e),s=n.pa.get(r.targetId);if(s.length>1)return n.pa.set(r.targetId,s.filter((t=>!Jo(t,e)))),void n.ga.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await cc(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Lc(n.remoteStore,r.targetId),fu(n,r.targetId)})).catch(wi)):(fu(n,r.targetId),await cc(n.localStore,r.targetId,!0))}async function uu(t,e){const n=Ks(t);try{const t=await function(t,e){const n=Ks(t),r=e.snapshotVersion;let s=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.os.newChangeBuffer({trackRemovals:!0});s=n.ns;const o=[];e.targetChanges.forEach(((i,a)=>{const h=s.get(a);if(!h)return;o.push(n.Qr.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,i.addedDocuments,a))));let c=h.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?c=c.withResumeToken($i.EMPTY_BYTE_STRING,hi.min()).withLastLimboFreeSnapshotVersion(hi.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,r)),s=s.insert(a,c),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(h,c,i)&&o.push(n.Qr.updateTargetData(t,c))}));let a=oa(),h=pa();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=pa(),s=pa();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=oa();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(hi.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):Us("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{cs:r,ls:s}}))}(t,i,e.documentUpdates).next((t=>{a=t.cs,h=t.ls}))),!r.isEqual(hi.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Ei.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,h))).next((()=>a))})).then((t=>(n.ns=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Sa.get(e);r&&(zs(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.ma=!0:t.modifiedDocuments.size>0?zs(r.ma):t.removedDocuments.size>0&&(zs(r.ma),r.ma=!1))})),await vu(n,t,e)}catch(t){await wi(t)}}function lu(t,e,n){const r=Ks(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.ga.forEach(((n,r)=>{const s=r.view.U_(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=Ks(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.Q_)t.U_(e)&&(r=!0)})),r&&tu(n)}(r.eventManager,e),t.length&&r.fa.u_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function du(t,e,n){const r=Ks(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Sa.get(e),i=s&&s.key;if(i){let t=new Pi(fi.comparator);t=t.insert(i,yo.newNoDocument(i,hi.min()));const n=pa().add(i),s=new th(hi.min(),new Map,new Pi(ii),t,n);await uu(r,s),r.wa=r.wa.remove(i),r.Sa.delete(e),yu(r)}else await cc(r.localStore,e,!1).then((()=>fu(r,e,n))).catch(wi)}function fu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.pa.get(e))t.ga.delete(r),n&&t.fa.xa(r,n);t.pa.delete(e),t.isPrimaryClient&&t.ba.Vr(e).forEach((e=>{t.ba.containsKey(e)||pu(t,e)}))}function pu(t,e){t.ya.delete(e.path.canonicalString());const n=t.wa.get(e);null!==n&&(Lc(t.remoteStore,n),t.wa=t.wa.remove(e),t.Sa.delete(n),yu(t))}function gu(t,e,n){for(const r of n)r instanceof nu?(t.ba.addReference(r.key,e),mu(t,r)):r instanceof ru?(Us("SyncEngine","Document no longer in limbo: "+r.key),t.ba.removeReference(r.key,e),t.ba.containsKey(r.key)||pu(t,r.key)):$s()}function mu(t,e){const n=e.key,r=n.path.canonicalString();t.wa.get(n)||t.ya.has(r)||(Us("SyncEngine","New document in limbo: "+n),t.ya.add(r),yu(t))}function yu(t){for(;t.ya.size>0&&t.wa.size<t.maxConcurrentLimboResolutions;){const e=t.ya.values().next().value;t.ya.delete(e);const n=new fi(ui.fromString(e)),r=t.va.next();t.Sa.set(r,new ou(n)),t.wa=t.wa.insert(n,r),xc(t.remoteStore,new Mh(Wo(Ko(n.path)),r,"TargetPurposeLimboResolution",ki._e))}}async function vu(t,e,n){const r=Ks(t),s=[],i=[],o=[];r.ga.isEmpty()||(r.ga.forEach(((t,a)=>{o.push(r.Ma(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=rc.Ki(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.fa.u_(s),await async function(t,e){const n=Ks(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Ei.forEach(e,(e=>Ei.forEach(e.qi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Ei.forEach(e.Qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Si(t))throw t;Us("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,s)}}}(r.localStore,i))}async function wu(t,e){const n=Ks(t);if(!n.currentUser.isEqual(e)){Us("SyncEngine","User change. New user:",e.toKey());const t=await ac(n.localStore,e);n.currentUser=e,function(t,e){t.Ca.forEach((t=>{t.forEach((t=>{t.reject(new Hs(Gs.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ca.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await vu(n,t.us)}}function Eu(t,e){const n=Ks(t),r=n.Sa.get(e);if(r&&r.ma)return pa().add(r.key);{let t=pa();const r=n.pa.get(e);if(!r)return t;for(const e of r){const r=n.ga.get(e);t=t.unionWith(r.view.la)}return t}}class bu{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=_c(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new oc(t,e,n,r)}(this.persistence,new ic,t.initialUser,this.serializer)}createPersistence(t){return new tc(nc.Hr,this.serializer)}createSharedClientState(t){return new dc}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class _u{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>lu(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=wu.bind(null,this.syncEngine),await async function(t,e){const n=Ks(t);e?(n.v_.delete(2),await Nc(n)):e||(n.v_.add(2),await kc(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Yc}createDatastore(t){const e=_c(t.databaseInfo.databaseId),n=function(t){return new Ec(t)}(t.databaseInfo);return function(t,e,n,r){return new Cc(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,s){return new Dc(t,e,n,r,s)}(this.localStore,this.datastore,t.asyncQueue,(t=>lu(this.syncEngine,t,0)),pc.D()?new pc:new fc)}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new au(t,e,n,r,s,i);return o&&(a.Fa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=Ks(t);Us("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await kc(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class Tu{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ba(this.observer.next,t)}error(t){this.observer.error?this.Ba(this.observer.error,t):Bs("Uncaught Error in snapshot listener:",t.toString())}La(){this.muted=!0}Ba(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Iu{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=Ms.UNAUTHENTICATED,this.clientId=si.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Us("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Us("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Hs(Gs.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Qs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Gc(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Su(t,e){t.asyncQueue.verifyOperationInProgress(),Us("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await ac(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Cu(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Us("FirestoreClient","Using user provided OfflineComponentProvider");try{await Su(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Gs.FAILED_PRECONDITION||t.code===Gs.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;js("Error using user provided cache. Falling back to memory cache: "+n),await Su(t,new bu)}}else Us("FirestoreClient","Using default OfflineComponentProvider"),await Su(t,new bu);return t._offlineComponents}(t);Us("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>$c(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>$c(e.remoteStore,n))),t._onlineComponents=e}async function Au(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Us("FirestoreClient","Using user provided OnlineComponentProvider"),await Cu(t,t._uninitializedComponentsProvider._online)):(Us("FirestoreClient","Using default OnlineComponentProvider"),await Cu(t,new _u))),t._onlineComponents}(t),n=e.eventManager;return n.onListen=hu.bind(null,e.syncEngine),n.onUnlisten=cu.bind(null,e.syncEngine),n}function Du(t,e,n={}){const r=new Qs;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new Tu({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=Ks(t),r=e.query;let s=!1;const i=n.queries.get(r);if(i){const t=i.Q_.indexOf(e);t>=0&&(i.Q_.splice(t,1),s=0===i.Q_.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}(t,o))),n.fromCache&&"server"===r.source?s.reject(new Hs(Gs.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new eu(n,i,{includeMetadataChanges:!0,Z_:!0});return async function(t,e){const n=Ks(t),r=e.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new Xc),s)try{i.q_=await n.onListen(r)}catch(t){const n=Gc(t,`Initialization of query '${ta(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.Q_.push(e),e.U_(n.onlineState),i.q_&&e.W_(i.q_)&&tu(n)}(t,o)}(await Au(t),t.asyncQueue,e,n,r))),r.promise}function Nu(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const ku=new Map;function xu(t){if(fi.isDocumentKey(t))throw new Hs(Gs.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Lu(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":$s()}function Ru(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Hs(Gs.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Lu(t);throw new Hs(Gs.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Ou{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Hs(Gs.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Hs(Gs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Hs(Gs.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Nu(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Hs(Gs.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Hs(Gs.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Hs(Gs.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Mu{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ou({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Hs(Gs.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Hs(Gs.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ou(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Xs;switch(t.type){case"firstParty":return new ti(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Hs(Gs.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=ku.get(t);e&&(Us("ComponentProvider","Removing Datastore"),ku.delete(t),e.terminate())}(this),Promise.resolve()}}class Pu{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Pu(this.firestore,t,this._query)}}class Vu{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Fu(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Vu(this.firestore,t,this._key)}}class Fu extends Pu{constructor(t,e,n){super(t,e,Ko(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Vu(this.firestore,null,new fi(t))}withConverter(t){return new Fu(this.firestore,t,this._path)}}class Uu{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new Tc(this,"async_queue_retry"),this._u=()=>{const t=bc();t&&Us("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const t=bc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.au(),this.uu(t)}enterRestrictedMode(t){if(!this.tu){this.tu=!0,this.su=t||!1;const e=bc();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._u)}}enqueue(t){if(this.au(),this.tu)return new Promise((()=>{}));const e=new Qs;return this.uu((()=>this.tu&&this.su?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.eu.push(t),this.cu())))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(t){if(!Si(t))throw t;Us("AsyncQueue","Operation failed with retryable error: "+t)}this.eu.length>0&&this.jo.qo((()=>this.cu()))}}uu(t){const e=this.Xa.then((()=>(this.iu=!0,t().catch((t=>{this.ru=t,this.iu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Bs("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.iu=!1,t))))));return this.Xa=e,e}enqueueAfterDelay(t,e,n){this.au(),this.ou.indexOf(t)>-1&&(e=0);const r=Kc.createAndSchedule(this,t,e,n,(t=>this.lu(t)));return this.nu.push(r),r}au(){this.ru&&$s()}verifyOperationInProgress(){}async hu(){let t;do{t=this.Xa,await t}while(t!==this.Xa)}Pu(t){for(const e of this.nu)if(e.timerId===t)return!0;return!1}Iu(t){return this.hu().then((()=>{this.nu.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.nu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.hu()}))}Tu(t){this.ou.push(t)}lu(t){const e=this.nu.indexOf(t);this.nu.splice(e,1)}}class Bu extends Mu{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Uu,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||ju(this),this._firestoreClient.terminate()}}function ju(t){var e,n,r;const s=t._freezeSettings(),i=function(t,e,n,r){return new Yi(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Nu(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new Iu(t._authCredentials,t._appCheckCredentials,t._queue,i),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class qu{constructor(t){this._byteString=t}static fromBase64String(t){try{return new qu($i.fromBase64String(t))}catch(t){throw new Hs(Gs.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new qu($i.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class $u{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Hs(Gs.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new di(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class zu{constructor(t){this._methodName=t}}class Ku{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Hs(Gs.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Hs(Gs.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return ii(this._lat,t._lat)||ii(this._long,t._long)}}const Gu=/^__.*__$/;function Hu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $s()}}class Qu{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Eu(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(t){return new Qu(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Au({path:n,Vu:!1});return r.mu(t),r}fu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Au({path:n,Vu:!1});return r.Eu(),r}gu(t){return this.Au({path:void 0,Vu:!0})}pu(t){return Zu(t,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Eu(){if(this.path)for(let t=0;t<this.path.length;t++)this.mu(this.path.get(t))}mu(t){if(0===t.length)throw this.pu("Document fields must not be empty");if(Hu(this.du)&&Gu.test(t))throw this.pu('Document fields cannot begin and end with "__"')}}class Wu{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||_c(t)}Su(t,e,n,r=!1){return new Qu({du:t,methodName:e,wu:n,path:di.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Xu(t,e){if(Yu(t=g(t)))return function(t,e,n){if(!Yu(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Lu(n);throw"an object"===r?e.pu(t+" a custom object"):e.pu(t+" "+r)}}("Unsupported field value:",e,t),function(t,e){const n={};return Mi(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Oi(t,((t,r)=>{const s=Xu(r,e.Ru(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}(t,e);if(t instanceof zu)return function(t,e){if(!Hu(e.du))throw e.pu(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.pu(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Vu&&4!==e.du)throw e.pu("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=Xu(s,e.gu(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=g(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return va(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=ai.fromDate(t);return{timestampValue:ph(e.serializer,n)}}if(t instanceof ai){const n=new ai(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ph(e.serializer,n)}}if(t instanceof Ku)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof qu)return{bytesValue:gh(e.serializer,t._byteString)};if(t instanceof Vu){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.pu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:yh(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.pu(`Unsupported field value: ${Lu(t)}`)}(t,e)}function Yu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ai||t instanceof Ku||t instanceof qu||t instanceof Vu||t instanceof zu)}const Ju=new RegExp("[~\\*/\\[\\]]");function Zu(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(i||o)&&(h+=" (found",i&&(h+=` in field ${r}`),o&&(h+=` in document ${s}`),h+=")"),new Hs(Gs.INVALID_ARGUMENT,a+t+h)}class tl{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Vu(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new el(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(nl("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class el extends tl{data(){return super.data()}}function nl(t,e){return"string"==typeof e?function(t,e,n){if(e.search(Ju)>=0)throw Zu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new $u(...e.split("."))._internalPath}catch(r){throw Zu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof $u?e._internalPath:e._delegate._internalPath}class rl{}class sl extends rl{}class il extends sl{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new il(t,e,n)}_apply(t){const e=this._parse(t);return ul(t._query,e),new Pu(t.firestore,t.converter,Xo(t._query,e))}_parse(t){const e=function(t){const e=t._freezeSettings(),n=_c(t._databaseId);return new Wu(t._databaseId,!!e.ignoreUndefinedProperties,n)}(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Hs(Gs.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){cl(o,i);const e=[];for(const n of o)e.push(hl(r,t,n));a={arrayValue:{values:e}}}else a=hl(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||cl(o,i),a=function(t,e,n,r=!1){return Xu(n,t.Su(r?4:3,e))}(n,"where",o,"in"===i||"not-in"===i);return Io.create(s,i,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}class ol extends rl{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new ol(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:So.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const t of r)ul(n,t),n=Xo(n,t)}(t._query,e),new Pu(t.firestore,t.converter,Xo(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class al extends sl{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new al(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Hs(Gs.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Hs(Gs.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new bo(e,n)}(t._query,this._field,this._direction);return new Pu(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new zo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function hl(t,e,n){if("string"==typeof(n=g(n))){if(""===n)throw new Hs(Gs.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ho(e)&&-1!==n.indexOf("/"))throw new Hs(Gs.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(ui.fromString(n));if(!fi.isDocumentKey(r))throw new Hs(Gs.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ao(t,new fi(r))}if(n instanceof Vu)return ao(t,n._key);throw new Hs(Gs.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Lu(n)}.`)}function cl(t,e){if(!Array.isArray(t)||0===t.length)throw new Hs(Gs.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ul(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Hs(Gs.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Hs(Gs.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class ll{convertValue(t,e="none"){switch(to(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Gi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Hi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw $s()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Oi(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Ku(Gi(t.latitude),Gi(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Wi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Xi(t));default:return null}}convertTimestamp(t){const e=Ki(t);return new ai(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ui.fromString(t);zs(Oh(n));const r=new Ji(n.get(1),n.get(3)),s=new fi(n.popFirst(5));return r.isEqual(e)||Bs(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}class dl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class fl extends tl{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new pl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(nl("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class pl extends fl{data(t={}){return super.data(t)}}class gl{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new dl(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new pl(this._firestore,this._userDataWriter,n.key,n,new dl(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Hs(Gs.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new pl(t._firestore,t._userDataWriter,n.doc.key,n.doc,new dl(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new pl(t._firestore,t._userDataWriter,e.doc.key,e.doc,new dl(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:ml(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function ml(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $s()}}class yl extends ll{constructor(t){super(),this.firestore=t}convertBytes(t){return new qu(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Vu(this.firestore,null,e)}}new WeakMap,function(t,e=!0){Ps="10.7.2",Z(new m("firestore",((t,{instanceIdentifier:n,options:r})=>{const s=t.getProvider("app").getImmediate(),i=new Bu(new Js(t.getProvider("auth-internal")),new ni(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Hs(Gs.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ji(t.options.projectId,e)}(s,n),s);return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),rt(Os,"4.4.1",t),rt(Os,"4.4.1","esm2017")}();let vl=[];nt({apiKey:"AIzaSyAWAohZ19uR7XH9CI11UD__cH9OQ_MAfZ4",authDomain:"dailyplanner-2748e.firebaseapp.com",projectId:"dailyplanner-2748e",storageBucket:"dailyplanner-2748e.appspot.com",messagingSenderId:"220761301594",appId:"1:220761301594:web:dd518ba8b9c4d2b329ae63",measurementId:"G-9V8HN3SJQ5"});const wl=function(t,e){const n=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}(function(t=Q){const e=X.get(t);if(!e&&t===Q&&o())return nt();if(!e)throw tt.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:"(default)"});if(!n._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=i())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var i;const o=(t=Ru(t,Mu))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&js("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Ms.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new Hs(Gs.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ms(o)}t._authCredentials=new Ys(new Ws(e,n))}}(n,...t)}return n}();function El(t){return function(t,e,...n){if(t=g(t),function(t,e,n){if(!n)throw new Hs(Gs.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("collection","path",e),t instanceof Mu){const r=ui.fromString(e,...n);return xu(r),new Fu(t,null,r)}{if(!(t instanceof Vu||t instanceof Fu))throw new Hs(Gs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ui.fromString(e,...n));return xu(r),new Fu(t.firestore,null,r)}}(wl,t)}async function bl(t){try{vl=[];const e=function(t,e,...n){let r=[];e instanceof rl&&r.push(e),r=r.concat(n),function(t){const e=t.filter((t=>t instanceof ol)).length,n=t.filter((t=>t instanceof il)).length;if(e>1||e>0&&n>0)throw new Hs(Gs.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const e of r)t=e._apply(t);return t}(El(t),function(t,e="asc"){const n=e,r=nl("orderBy","startingT");return al._create(r,n)}()),n=await function(t){t=Ru(t,Pu);const e=Ru(t.firestore,Bu),n=function(t){return t._firestoreClient||ju(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(e),r=new yl(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Hs(Gs.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),Du(n,t._query).then((n=>new gl(e,r,t,n)))}(e);return n.size>0?(n.docs.forEach((t=>{vl.push({...t.data(),id:t.id})})),vl):vl}catch(t){console.log(t)}}const _l=document.getElementById("schedulediv"),Tl=document.getElementById("Dayplanul");function Il(t){t.classList.toggle("Checked")}_l.addEventListener("wheel",(function(t){this.scrollTop+=t.deltaY,t.preventDefault()}));let Sl=[];const Cl=document.getElementById("IChome");function Al(){const t=new Date;return t.getFullYear()+"-"+Nl(t.getMonth()+1)+"-"+Nl(t.getDate())}function Dl(){const t=new Date;return Nl(t.getHours())+":"+Nl(t.getMinutes())}function Nl(t){return t<10?"0"+t:t}function kl(t,e){const n=document.getElementById("Currenttab"),r=document.createElement("label"),s=document.createElement("label");r.textContent=t,s.textContent=e,n.append(r,s)}async function xl(t,e,n){const r=document.createElement("li"),s=document.createElement("label"),i=document.createElement("label"),o=function(){const t=document.createElement("div");return t.classList.add("myCheckbox"),t.onclick=function(){Il(t)},t}();s.classList.add("lbltime"),i.classList.add("lblevent"),s.textContent=t,i.textContent=e,!0===n&&Il(o),r.append(s,i,o),Tl.append(r)}Cl.style.padding="4px",Cl.style.borderBottom="#d08e63 solid 4px",Cl.style.borderRadius="30%",console.log(Al()),console.log(Dl()),async function(){if(Sl=await bl(Al()),0===Sl.length)console.log("nothing");else for(let t=0;t<Sl.length;t++){let e=Sl[t];if(e.startingT<=Dl()&&e.finishingT>=Dl()){console.log("we are here ");let t=`From ${e.startingT} to ${e.finishingT}`;kl(e.event,t)}xl(`${e.startingT} ${e.finishingT}`,e.event,e.completed)}}(),document.getElementById("addpageIC").addEventListener("click",(()=>{Cl.style.border="none",window.location.href="dayplan.html"}))})();
//# sourceMappingURL=homepage.bundle.js.map